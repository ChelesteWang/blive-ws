/**
 * id: lV3a
 * path: @bilibili-live/fmp4.js
 */

function(require,module,exports) {
var define;
var t;!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof t&&t.amd?t([],r):"object"==typeof exports?exports.fmp4=r():e.fmp4=r()}(window,function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e){t.exports={SomeError:function(t,e){this.name=t,this.message=e,this.stack=(new Error).stack},errorAudioInfo:10001,errorVideoInfo:10002,errorAudioTrack:10003,errorVideoTrack:10004,errorUnknownCodec:10005,errorFlvPacket:10006,errorFlvDts:10007,errorNetworkTimeout:11e3,errorNetworkFetch:11001,errorNetworkRead:11002,errorMseOpen:11003,errorMseAppend:11004,errorM3u8Data:11010,errorMp4Data:11011,errorMp4Dts:11012,errorM3u8NotUpdate:11013}},function(t,e){var r=[[0,200,0,128,35,128],[33,0,73,144,2,25,0,35,128],[0,200,0,128,32,132,1,38,64,8,100,0,142],[0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56],[0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56],[0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]],i=[[1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90],[1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10],[1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10]],n=[90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94];function a(t,e,r){for(;e<r;)if(3!==t[e]&&0!==t[e])e+=3;else{if(0===t[e-2]&&0===t[e-1]&&3===t[e])return e-2;e+=1}return null}t.exports={getSilentFrame:function(t,e){switch(t){case 2:if(e>=1&&e<=6)return new Uint8Array(r[e-1]);break;default:if(e>=1&&e<=3)return new Uint8Array(i[e-1].concat(n))}return null},ebsp2rbsp:function(t){for(var e=t,r=e.byteLength,i=new Uint8Array(r),n=0,s=0;;){var o=a(e,s,r);if(null===o)break;i.set(e.subarray(s,o+2),n),n+=o-s+2,s=o+3}return i.set(e.subarray(s,e.length),n),n+=e.length-s,i.subarray(0,n)},to02uString:function(t){var e=t.toString(10);return e.length<2&&(e="0"+e),e},to02xString:function(t){var e=t.toString(16);return e.length<2&&(e="0"+e),e}}},function(t,e,r){var i=r(3).checkChromeVer,n=r(10).BufferDetector,a=r(11).fMp4Player,s=r(19).Hls7Player,o=r(23).NativePlayer;t.exports={checkChromeVer:i,BufferDetector:n,fMp4Player:a,Hls7Player:s,NativePlayer:o}},function(t,e){var r=void 0;t.exports.checkChromeVer=function(){if(void 0!==r)return r;try{var t=navigator.userAgent,e=t.indexOf("Chrome/");if(e>0){e+=7;var i=t.indexOf(".",e);return-1===i&&(i=t.length),r=parseInt(t.substring(e,i)),console.log("Chrome verion: ".concat(r)),r}}catch(t){console.warn("parse Chrome version failed",t)}return r=0}},function(t,e,r){function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var n=r(12).MseController,a=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._mediaSource=e,this._player=r,this._url=null,this._isOpened=!1,this._isDestroied=!1,this._mimeType=null,this._mseController=null,this._keepUsedBuffer=10,this._timeout=0,this._lastRemovedPos=0,this._firstResponseNotified=!1,this._firstPacketNotified=!1,this._receivedBytes=0,this.startTime=0,this.onFirstResponse=null,this.onFirstPacket=null,this.onMetaData=null,this.onSeiData=null,this.onEndOfStream=null,this.onFileFetched=null,this.onNetworkError=null,this.onParserError=null}var e,r;return e=t,(r=[{key:"destroy",value:function(){this._isDestroied||(this._isDestroied=!0,this._player.src&&URL.revokeObjectURL(this._player.src)),this._mseController&&(this._mseController.destroy(),this._mseController=null),this._isOpened=!1,this._lastRemovedPos=0,this._mimeType=null,this._firstResponseNotified=!1,this._firstPacketNotified=!1,this._receivedBytes=0}},{key:"_notifyNetworkError",value:function(t,e){this.onNetworkError&&!this._isDestroied&&this.onNetworkError(t,e)}},{key:"_notifyParserError",value:function(t,e){this.onParserError&&!this._isDestroied&&this.onParserError(t,e)}},{key:"_onMseError",value:function(t,e){this._notifyParserError(t,{url:this._url,info:e})}},{key:"_setup",value:function(t){this._mseController&&this._mseController.destroy(),this._mseController=new n(this._mediaSource,this.onEndOfStream,this._onMseError.bind(this)),this._lastRemovedPos=0,this._receivedBytes=0,this._isDestroied=!1,this._url=t,this._mediaSource&&(this._mediaSource.createObjectURL?this._player.src=this._mediaSource.createObjectURL(this._player):this._player.src=URL.createObjectURL(this._mediaSource))}},{key:"_ensureMse",value:function(t){this._mimeType=t,t&&!this._isOpened&&this._mseController&&(this._isOpened=this._mseController.addSource(t))}},{key:"_pushBuffer",value:function(t){this._mseController&&this._mseController.pushBuffer(t)}},{key:"_pushEnd",value:function(){this._mseController&&this._mseController.pushEnd()}},{key:"_removeOutdated",value:function(){var t=this._player.currentTime;if(t>this._lastRemovedPos+this._keepUsedBuffer+10){var e=this._lastRemovedPos>10?this._lastRemovedPos-10:0,r=Math.floor(t-this._keepUsedBuffer);this._mseController&&this._mseController.removeBuffer(e,r)&&(this._lastRemovedPos=r)}}},{key:"version",get:function(){}},{key:"buffered",get:function(){var t=this._player.buffered;return t&&t.length>0?t.end(t.length-1)-this._player.currentTime:0}},{key:"mimeType",get:function(){return this._mimeType}},{key:"receivedBytes",get:function(){return this._receivedBytes}},{key:"keepUsedBuffer",set:function(t){this._keepUsedBuffer=t}},{key:"timeout",set:function(t){this._timeout=t}}])&&i(e.prototype,r),t}();t.exports.LivePlayer=a},function(t,e,r){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=r(14),a=r(15),s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],o=[44100,48e3,32e3,-1],u=function(t,e){return 1===e&&(e=2),"mp4a."+t.toString(16)+(e?"."+e.toString():"")},h=function t(e,r,n,a,s){i(this,t),this.profile=r,this.rate=n,this.channel=a,this.frame=s,this.codecs=u(e,r)},c=function t(e,r,n,a){i(this,t),this.width=e,this.height=r,this.nalu=n,this.codecs=a};t.exports={audioTypeAAC:64,audioTypeMP3:107,getAacCodec:u,parseAudioInfo:function(t,e){if(64===e){if(t.length<2)return null;var r=t[0]>>>3&31,i=(7&t[0])<<1|t[1]>>>7&1,n=t[1]>>3&15;return new h(e,r,s[i],n,1024)}if(107===e){if(t.length<4)return null;var a=t[1]>>>3&3,u=t[1]>>>1&3;if(u<1||u>3)return null;var c,l,f=t[2]>>>2&3,d=3==(t[3]>>>6&3)?1:2;switch(a){case 3:c=o[f];break;case 2:c=o[f]>>>1;break;default:c=o[f]>>>2}switch(u){case 3:l=3===a?1152:576;break;case 2:l=1152;break;default:l=384}return new h(e,0,c,d,l)}return null},parseVideoInfo:function(t,e){var r;if(-7===e)r=new n.AvcParser;else{if(-12!==e)return null;r=new a.HevcParser}if(0!==r.parse(t))return null;var i=r.displaySize;return new c(i.width,i.height,r.nalu,r.codecs)}}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var i=[0,16,1,2,4,8,32,3,5,10,12,15,47,7,11,13,14,6,9,31,35,37,42,44,33,34,36,40,39,43,45,46,17,18,20,24,19,21,26,28,23,27,29,30,22,25,38,41],n=[47,31,15,0,23,27,29,30,7,11,13,14,39,43,45,46,16,3,5,10,12,19,21,26,28,35,37,42,44,1,2,4,8,17,18,20,24,6,9,22,25,32,33,34,36,40,38,41],a=[15,0,7,11,13,14,3,5,10,12,1,2,4,8,6,9],s=[0,1,2,4,8,3,5,10,12,15,7,11,13,14,6,9],o=function(t){!1===t&&console.warn(t)},u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._data=e,this._bytes=e.length,this._offsetBits=0,this._offsetBytes=0}var e,u;return e=t,(u=[{key:"moveNextBit",value:function(){++this._offsetBits,this._offsetBits>=8&&(this._offsetBits%=8,this._offsetBytes+1<=this._bytes&&(++this._offsetBytes,this._offsetBytes<this._bytes&&3===this._data[this._offsetBytes]&&this._offsetBytes>1&&0===this._data[this._offsetBytes-1]&&0===this._data[this._offsetBytes-2]&&++this._offsetBytes))}},{key:"getOffset",value:function(){return{bytes:this._offsetBytes,bits:this._offsetBits}}},{key:"setOffset",value:function(t,e){return t>this._bytes||e>8?-1:(this._offsetBits=e,this._offsetBytes=t,0)}},{key:"nextBit",value:function(){return o(this._data&&this._bytes>0),this._offsetBytes>=this._bytes?-1:this._data[this._offsetBytes]>>>7-this._offsetBits&1}},{key:"nextBits",value:function(e){var r=new t(this._data);return r._offsetBits=this._offsetBits,r._offsetBytes=this._offsetBytes,r.readBits(e)}},{key:"readBit",value:function(){if(o(this._data&&this._bytes>0),this._offsetBytes>=this._bytes)return-1;var t=this._data[this._offsetBytes]>>>7-this._offsetBits&1;return this.moveNextBit(),o(0===t||1===t),t}},{key:"readBits",value:function(t){o(t>0&&t<=32);for(var e=0,r=0,i=0;r<t&&-1!==i;r++)i=this.readBit(),o(0===i||1===i),e=e<<1|i;return e}},{key:"readBool",value:function(){return 1===this.readBit()}},{key:"readUe",value:function(){var t,e=-1;for(t=0;!t&&-1!==t;++e)t=this.readBit(),o(0===t||1===t);return t=0,e>0&&(o(e<32),t=this.readBits(e)),(1<<e)-1+t}},{key:"readSe",value:function(){var t=this.readUe();return(t+1)/2*(0==t%2?-1:1)}},{key:"readMe",value:function(t,e){var r=this.readUe();return t?(o(r>=0&&r<48),0!==e?i[r]:n[r]):(o(r>=0&&r<16),0!==e?a[r]:s[r])}},{key:"readTe",value:function(){var t=this.readUe();return 1!==t?t:0!==this.readBit()?0:1}}])&&r(e.prototype,u),t}();t.exports.BitStream=u},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function t(e,r,n,a){i(this,t),this.name=e,this.value=r,this.offset=n,this.end=a},a=function(){function t(){i(this,t);try{this._textDecoder=new TextDecoder}catch(t){this._textDecoder=null,this._fromChar=String.fromCodePoint?String.fromCodePoint:String.fromCharCode}}var e,a;return e=t,(a=[{key:"decodeUtf8",value:function(t){if(this._textDecoder){var e=t.indexOf(0);return-1!==e&&(t=t.subarray(0,e)),this._textDecoder.decode(t)}for(var r=t.length,i="",n=0;n<r;){var a=t[n++];if(0===a)break;var s=0;switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s=a;break;case 12:case 13:s=(31&a)<<6|63&t[n++];break;case 14:s=(15&a)<<12|(63&t[n++])<<6|(63&t[n++])<<0;break;case 15:s=(7&a)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++]}0!==s&&(i+=this._fromChar(s))}return i}},{key:"parse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(r||(r=t.byteLength-1);e<r;)try{var i=this._parseValue(t,null,e),n=this._parseValue(t,i,i.offset);if(e=n.offset,"onMetaData"===i.value)return n.value}catch(t){console.warn("parse failed",t);break}return null}},{key:"_parseValue",value:function(t,e,r){var i,a=t.getUint8(r++),s=!1;switch(a){case 0:i=t.getFloat64(r),r+=8;break;case 1:i=!!t.getUint8(r),r+=1;break;case 2:case 12:var o=this._parseArray(t,r,12===a);r+=2+o.length,i=this.decodeUtf8(o);break;case 3:i={},r=this._parseObjects(t,r,65535,i);break;case 8:var u=t.getUint32(r);r+=4,i={},r=this._parseObjects(t,r,u,i);break;case 9:i=null,s=!0;break;case 10:var h=t.byteLength-1,c=t.getUint32(r);for(r+=4,i=[];c-- >0&&r<h;){var l=this._parseValue(t,null,r);r=l.offset,i.push(l.value)}break;case 11:i=this._parseDate(t,r),r+=10}return new n(e,i,r,s)}},{key:"_parseArray",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=r?t.getUint32(e):t.getUint16(e);return new Uint8Array(t.buffer,t.byteOffset+e+(r?4:2),i)}},{key:"_parseDate",value:function(t,e){var r=t.getFloat64(e),i=t.getInt16(e+8);return new Date(r+=60*i*1e3)}},{key:"_parseObject",value:function(t,e){var r=this._parseArray(t,e);e+=2+r.length;var i=this.decodeUtf8(r);return this._parseValue(t,i,e)}},{key:"_parseObjects",value:function(t,e,r,i){for(var n=t.byteLength-1;r-- >0&&e<n;){var a=this._parseObject(t,e);if(e=a.offset,a.end)break;i[a.name]=a.value}return e}}])&&r(e.prototype,a),t}();t.exports.AmfParser=a},function(t,e,r){function i(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){u=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw s}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function a(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s=r(1),o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"_readSeiNumber",value:function(t,e){for(var r=0;e.offset<t.byteLength;){var i=t[e.offset];if(e.offset+=1,255!==i)return r+i;r+=255}return null}},{key:"_isEndOfSei",value:function(t,e){return e.offset>=t.byteLength||128===t[e.offset]&&(e.offset+=1,!0)}},{key:"_readSeiMessage",value:function(t,e){var r=this._readSeiNumber(t,e),i=this._readSeiNumber(t,e);if(null!==r&&null!==r){var n=e.offset+i;if(n<t.byteLength){var a={payloadType:r,payloadData:t.subarray(e.offset,n)};return e.offset+=i,a}}return null}},{key:"readSeiMessages",value:function(t){for(var e=[],r={offset:0};!this._isEndOfSei(t,r);){var i=this._readSeiMessage(t,r);if(null===i)break;e.push(i)}return e}},{key:"parse",value:function(e,r,n,a,o,u,h,c){for(var l=r+n,f=r;f+u<l;){for(var d=0,_=0;_<u;_++)d=d<<8|e[f++];var v=f+d;if(v>l||v<=f)break;if((h?e[f++]>>1:31&e[f])==(h?39:6)){var p,y=s.ebsp2rbsp(e.subarray(f+1,v)),m=i(t.readSeiMessages(y));try{for(m.s();!(p=m.n()).done;){var g=p.value;5===g.payloadType&&g.payloadData.length>=16&&c(a,o,g.payloadData.slice(0,16),g.payloadData.slice(16))}}catch(t){m.e(t)}finally{m.f()}}f=v}}}],null&&a(e.prototype,null),r&&a(e,r),t}();t.exports.SeiParser=o},function(t,e,r){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}var s=r(0),o=!!window.fetch,u=!!window.ReadableStream,h=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i(this,t),this._callbackMap=new Map,this._onResponse=e,this._onResult=r,this._onError=n}return a(t,[{key:"fetchAsBuffer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._setTimeout(t,r);o?this._doFetch(t,e,"arrayBuffer",i):this._doRequest(t,"arraybuffer",i)}},{key:"fetchAsJson",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._setTimeout(t,r);o?this._doFetch(t,e,"json",i):this._doRequest(t,"json",i)}},{key:"fetchAsText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._setTimeout(t,r);o?this._doFetch(t,e,"text",i):this._doRequest(t,"text",i)}},{key:"fetchAsStream",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(u){var n=this._setTimeout(t,i);fetch(t,r?{}:{cache:"no-store"}).then(function(r){if(void 0===n||e._clearTimeout(n))if(e._onResponse(t,r)&&r.ok){var i=r.body.getReader(),a=[],o=function(r){!r.done&&a[0]?a[0]():a[0]=null,e._onResult(t,r.value,r.done)};a[0]=function(){i.read().then(o).catch(function(r){e._onError(t,s.errorNetworkRead,r)})},a[0]()}else r.body.getReader().cancel()}).catch(function(r){(void 0===n||e._clearTimeout(n))&&e._onError(t,s.errorNetworkFetch,r)})}else this.fetchAsBuffer(t,r,i)}},{key:"_doFetch",value:function(t,e,r,i){var n=this;fetch(t,e?{}:{cache:"no-store"}).then(function(e){(void 0===i||n._clearTimeout(i))&&(n._onResponse(t,e)&&e.ok?e[r]().then(function(e){n._onResult(t,e,!0)}).catch(function(e){n._onError(t,s.errorNetworkRead,e)}):e.body.getReader().cancel())}).catch(function(e){(void 0===i||n._clearTimeout(i))&&n._onError(t,s.errorNetworkFetch,e)})}},{key:"_doRequest",value:function(t,e,r){var i=this,n=new XMLHttpRequest;n.onreadystatechange=function(e){(void 0===r||i._clearTimeout(r))&&2===n.readyState&&(n.ok=n.status>=200&&n.status<=299,i._onResponse(t,n))},n.onload=function(e){n.status>=200&&n.status<=299&&i._onResult(t,n.response,!0)},n.onerror=function(e){(void 0===r||i._clearTimeout(r))&&i._onError(t,n.readyState>2?s.errorNetworkRead:s.errorNetworkFetch,e)},n.open("GET",t),n.responseType=e,n.send()}},{key:"_clearTimeout",value:function(t){return void 0!==t&&(window.clearTimeout(t),this._callbackMap.delete(t))}},{key:"_setTimeout",value:function(t,e){var r=this;if(e>0){var i=[];return i[0]=window.setTimeout(function(){r._callbackMap.delete(i[0]),r._onError(t,s.errorNetworkTimeout,e)},e),this._callbackMap.set(i[0],1),i[0]}}}]),t}(),c=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i(this,t),this._readDone=!1,this._reader=null,this._onResponse=e,this._onData=r,this._onError=n,this._onDataFetchedBinder=this._onDataFetched.bind(this),this._onReadErrorBinder=this._onReadError.bind(this)}return a(t,[{key:"destroy",value:function(){this._readDone=!0,this._onData=null}},{key:"fetchAsStream",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o={};if(0!=i){var u={};u.Range="bytes=".concat(i,"-")+(n>0?(n-1).toString():""),o.headers=u}r||(o.cache="no-store");var h=a>0?window.setTimeout(function(){e._onError(s.errorNetworkTimeout,a)},a):void 0;fetch(t,o).then(function(t){e._clearTimeout(h),e._reader&&(e._reader.cancel(),e._reader=null),e._onResponse(t)&&t.ok?(e._readDone=!1,e._reader=t.body.getReader(),e._reader.read().then(e._onDataFetchedBinder).catch(e._onReadErrorBinder)):t.body.getReader().cancel()}).catch(function(t){e._clearTimeout(h),e._onError(s.errorNetworkFetch,t)})}},{key:"_onDataFetched",value:function(t){t.done&&(this._reader=null,this._readDone=!0),this._reader&&(this._readDone?(this._reader.cancel(),this._reader=null):this._reader.read().then(this._onDataFetchedBinder).catch(this._onReadErrorBinder)),this._onData&&!this._onData(t.value)&&(this._readDone=!0,this._reader&&(this._reader.cancel(),this._reader=null))}},{key:"_onReadError",value:function(t){this._onError(s.errorNetworkRead,t)}},{key:"_clearTimeout",value:function(t){void 0!==t&&window.clearTimeout(t)}}]),t}();t.exports={Fetcher:h,StreamFetcher:c}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var i=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this._player=e,this._minBufferMs=r,this._loaded=!1,this._waitCount=0,this._waitDuration=0,this._waiting=!1,this._beginWaitTime=0,this._savedPaused=void 0,this._timer=void 0,this.minWaitMs=100,this._onLoadedDataBinder=this._onLoadedData.bind(this),this._onPlayingBinder=this._onPlaying.bind(this),this._onWaitingBinder=this._onWaiting.bind(this),e.addEventListener("loadeddata",this._onLoadedDataBinder),e.addEventListener("playing",this._onPlayingBinder),e.addEventListener("waiting",this._onWaitingBinder)}var e,i;return e=t,(i=[{key:"destroy",value:function(){this._clearTimer(),this._player.removeEventListener("waiting",this._onWaitingBinder),this._player.removeEventListener("playing",this._onPlayingBinder),this._player.removeEventListener("loadeddata",this._onLoadedDataBinder),this._waitCount=0,this._waitDuration=0}},{key:"_onLoadedData",value:function(t){this._loaded=!0}},{key:"_onPlaying",value:function(t){if(this._waiting){var e=performance.now()-this._beginWaitTime;e>this.minWaitMs&&(this._waitCount++,this._waitDuration+=e),this._waiting=!1}}},{key:"_onWaiting",value:function(t){var e=this;if(this._loaded&&!this._player.seeking){var r=this._player.readyState;if(!(r===HTMLMediaElement.HAVE_ENOUGH_DATA||r===HTMLMediaElement.HAVE_CURRENT_DATA&&this.buffered>=2)&&(this._waiting=!0,this._beginWaitTime=performance.now(),this._savedPaused=void 0,this._clearTimer(),this._minBufferMs>this.minWaitMs)){var i=this._minBufferMs/1e3,n=this._beginWaitTime+this._minBufferMs+1e3;this._timer=window.setInterval(function(){!e._waiting||e.buffered>=i||performance.now()>=n?(e._clearTimer(),!e._savedPaused&&e._player.paused&&e._player.play().then(function(){}).catch(function(t){})):void 0===e._savedPaused&&(e._savedPaused=!!e._player.paused,e._player.pause())},2*this.minWaitMs)}}}},{key:"_clearTimer",value:function(){void 0!==this._timer&&(window.clearInterval(this._timer),this._timer=void 0)}},{key:"buffered",get:function(){var t=this._player.buffered;return t&&t.length>0?t.end(t.length-1)-this._player.currentTime:0}},{key:"waitedCount",get:function(){return this._waitCount}},{key:"waitedDuration",get:function(){return Math.round(this._waitDuration)}}])&&r(e.prototype,i),t}();t.exports.BufferDetector=i},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,i=c(t);if(e){var n=c(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return u(this,r)}}function u(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?h(t):e}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=r(0),f=r(4),d=r(13),_=r(18).lowerBound,v=r(9).StreamFetcher,p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(u,t);var e,r,i=o(u);function u(t,e){var r;return function(t,e){if(!(t instanceof u))throw new TypeError("Cannot call a class as a function")}(this),r=i.call(this,t,e),console.log("fMp4Player ".concat(r.version)),r.maxDuration=30,r.minDuration=10,r.startTime=0,r._contentLength=void 0,r._loader=null,r._readDone=!1,r._readPaused=!1,r._readPosition=0,r._fmp4Muxer=null,r._checkBufferInterval=void 0,r._onCheckBufferBinder=r._onCheckBuffer.bind(h(r)),r._onResponseBinder=r._onResponse.bind(h(r)),r._onDataFetchedBinder=r._onDataFetched.bind(h(r)),r._onDataConvertedBinder=r._onDataConverted.bind(h(r)),r._onMetaDataBinder=r._onMetaDataParsed.bind(h(r)),r._onConvertErrorBinder=r._onConvertError.bind(h(r)),r._onReadErrorBinder=r._onReadError.bind(h(r)),r}return e=u,(r=[{key:"destroy",value:function(){a(c(u.prototype),"destroy",this).call(this),void 0!==this._checkBufferInterval&&(window.clearInterval(this._checkBufferInterval),this._checkBufferInterval=void 0),this._firstPacketNotified=!1,this._readPaused=!1,this._readDone=!0,this._loader&&(this._loader.destroy(),this._loader=null),this._fmp4Muxer&&(this._fmp4Muxer.destroy(),this._fmp4Muxer=null),this._contentLength=void 0}},{key:"createFetcher",value:function(t,e,r){return new v(t,e,r)}},{key:"_fetchUrl",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._contentLength=void 0,this._receivedBytes=0,this._readDone=!1,this._readPaused=!1,this._readPosition=t,this._loader=this.createFetcher(this._onResponseBinder,this._onDataFetchedBinder,this._onReadErrorBinder),this._loader.fetchAsStream(this._url,!1,t,-1,this._timeout)}},{key:"_onDataConverted",value:function(t){this._ensureMse(this._mimeType),this._pushBuffer(t)}},{key:"_onMetaDataParsed",value:function(t){var e=this;if(this._mimeType=this._fmp4Muxer.mimeType,this.onMetaData&&this.onMetaData(t),this._contentLength&&this.startTime>0){var r=t.keyframes;if(r&&r.times&&r.filepositions){var i=_(r.times,this.startTime);if(i>=0&&i<r.filepositions.length){var n=r.filepositions[i];r.times[i]>this.startTime&&i>0&&(n=r.filepositions[--i]),this._fmp4Muxer&&this._fmp4Muxer.reset(),console.log("seek to: ".concat(r.times[i],"/").concat(t.duration,"s, pos=").concat(n));var a=function(){e._seekToPosition(n)};window.Promise?Promise.resolve().then(a):window.setTimeout(a,0)}else console.warn("seek failed: ".concat(this.startTime,"/").concat(t.duration,"s"))}this.startTime=0}}},{key:"_onConvertError",value:function(t,e){this._notifyParserError(t,{url:this._url,info:e})}},{key:"_onReadError",value:function(t,e){this._notifyNetworkError(t,{url:this._url,info:e})}},{key:"_processFetchedData",value:function(t){this._fmp4Muxer?this._fmp4Muxer.input(t):this._onDataConverted(t)}},{key:"_seekToPosition",value:function(t){this._fmp4Muxer&&this._fmp4Muxer.reset(),this._loader&&(this._loader.destroy(),this._loader=null),this._fetchUrl(t)}},{key:"_onDataFetched",value:function(t){return!(this._isDestroied||(!this._firstPacketNotified&&this.onFirstPacket&&(this._firstPacketNotified=!0,this.onFirstPacket()),t?(this._removeOutdated(),this._processFetchedData(t),this._receivedBytes+=t.length,this._readPosition+=t.length):t||(this._readDone=void 0===this._contentLength||this._receivedBytes>=this._contentLength,this._readDone&&this._pushEnd()),this._readDone||this._readPaused))}},{key:"_onResponse",value:function(t){if(this._isDestroied)return!1;if(!t.ok)return this._notifyNetworkError(l.errorNetworkFetch,{url:this._url,status:t.status}),!1;!this._firstResponseNotified&&this.onFirstResponse&&(this._firstResponseNotified=!0,this.onFirstResponse(t));var e=t.headers.get("Content-Length"),r=e?parseInt(e):void 0;void 0===this._contentLength&&(this._contentLength=r),this._contentLength&&void 0===this._checkBufferInterval&&(this._checkBufferInterval=window.setInterval(this._onCheckBufferBinder,500));var i=t.headers.get("Content-Type");return i&&-1!==i.indexOf("video/mp4")?(this._mimeType=i,this._fmp4Muxer=null):null===this._fmp4Muxer&&(this._mimeType=null,this._fmp4Muxer=new d.fMp4Muxer(250,this._onDataConvertedBinder,this._onMetaDataBinder,this.onSeiData,this._onConvertErrorBinder)),!0}},{key:"_onCheckBuffer",value:function(){var t=this.buffered;t<=this.minDuration&&this._readPaused&&this._receivedBytes<this._contentLength?(this._readPaused=!1,this._loader.fetchAsStream(this._url,!1,this._readPosition,-1,this._timeout)):t>=this.maxDuration&&!this._readPaused&&(this._readPaused=!0)}},{key:"version",get:function(){return"v1.40"}},{key:"src",set:function(t){this.destroy(),this._setup(t),this._fetchUrl()}}])&&n(e.prototype,r),u}(f.LivePlayer);t.exports.fMp4Player=p},function(t,e,r){function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var n=r(0),a=function(){function t(e,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._mediaSource=e,this._onEnded=r,this._onError=i,this._dataList=[],this._mimeType=null,this._sourceOpened=!1,this._sourceBuffer=null,this._eosBuffer=new Uint8Array,this._onSourceOpenBinder=this._onSourceOpen.bind(this),this._onUpdateEndBinder=this._onUpdateEnd.bind(this),e&&e.addEventListener("sourceopen",this._onSourceOpenBinder)}var e,r;return e=t,(r=[{key:"destroy",value:function(){this.removeSource(),this._dataList.length=0,this._mediaSource=null,this._mimeType=null,this._sourceOpened=!1}},{key:"addSource",value:function(t){if(this._mimeType=t,t&&this._sourceOpened&&!this._sourceBuffer)try{this._sourceBuffer=this._mediaSource.addSourceBuffer(t),this._sourceBuffer&&this._sourceBuffer.addEventListener("updateend",this._onUpdateEndBinder)}catch(t){this._onError&&this._onError(n.errorMseOpen,t)}return null!==this._sourceBuffer}},{key:"removeSource",value:function(){this._sourceBuffer&&(this._sourceBuffer.removeEventListener("updateend",this._onUpdateEndBinder,!1),this._mediaSource.removeSourceBuffer(this._sourceBuffer),this._sourceBuffer=null)}},{key:"pushBuffer",value:function(t){this._dataList.push(t),this._onUpdateEnd()}},{key:"pushEnd",value:function(){0!==this._dataList.length||this._sourceBuffer?(this._dataList.push(this._eosBuffer),this._onUpdateEnd()):this._onEnded&&this._onEnded()}},{key:"removeBuffer",value:function(t,e){try{if(!this._sourceBuffer.updating)return this._sourceBuffer.remove(t,e),!0}catch(r){console.warn("remove buffer failed: ".concat(t," -> ").concat(e),r)}return!1}},{key:"_onSourceOpen",value:function(){this._mediaSource&&(this._mediaSource.duration=1/0,this._mediaSource.removeEventListener("sourceopen",this._onSourceOpenBinder),this._sourceOpened=!0,this._mimeType&&this.addSource(this._mimeType))}},{key:"_onUpdateEnd",value:function(){var t=this._sourceBuffer;if(t&&!t.updating){var e=this._dataList;if(e.length){var r=e.shift();try{r===this._eosBuffer?("open"===this._mediaSource.readyState&&this._mediaSource.endOfStream(),this._onEnded&&this._onEnded()):null!==r&&t.appendBuffer(r),r=null}catch(t){"QuotaExceededError"===t.name?r&&e.unshift(r):this._onError&&this._onError(n.errorMseAppend,t)}}}}}])&&i(e.prototype,r),t}();t.exports.MseController=a},function(t,e,r){function i(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){u=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw s}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),t}var u=r(5),h=r(0),c=r(16),l=r(17),f=r(3),d=r(1),_=r(8).SeiParser,v=function(){function t(e,r,i){a(this,t),this.type=e,this.id=r,this.tag=i,this.baseMediaDecodeTime=0,this.extraData=null,this.dataOffset=0,this.duration=0,this.samples=[],this.sequenceDts=null,this.timestampOffset=0,this.totalDuration=0,this.totalSampleCount=0,this.audioInfo=null,this.objectType=0,this.defaultDuration=0,this.maxGapDuration=0,this.videoInfo=null,this.averageDuration=0}return o(t,[{key:"timeScale",get:function(){return null!==this.audioInfo?this.audioInfo.rate:9e4}},{key:"channelCount",get:function(){return null!==this.audioInfo?this.audioInfo.channel:null}},{key:"sampleRate",get:function(){return null!==this.audioInfo?this.audioInfo.rate:null}},{key:"sampleBits",get:function(){return 16}},{key:"width",get:function(){return null!==this.videoInfo?this.videoInfo.width:null}},{key:"height",get:function(){return null!==this.videoInfo?this.videoInfo.height:null}}]),t}(),p=function(){function t(e,r,i,n,s){a(this,t);var o=f.checkChromeVer();this._chrome4x=o>0&&o<=49,this._audioTrackIndex=-1,this._videoTrackIndex=-1,this._lastSegmentDts=0,this._mdatSize=0,this._metaChanged=0,this._metaData={},this._nextTrackId=1,this._onMetaData=i,this._onSegment=r,this._onSeiData=n,this._onError=s,this._parser=new c.FlvParser(this._onSampleReceived.bind(this),this._onMetaDataReceived.bind(this)),this._segmentIsGop=!0,this._segmentDuration=e,this._sequenceNumber=1,this._tracks=[],this._unknownTypes=new Set}return o(t,[{key:"destroy",value:function(){}},{key:"reset",value:function(){this._parser.clear(),this._lastSegmentDts=0,this._mdatSize=0,this._segmentIsGop=!0;var t,e=i(this._tracks);try{for(e.s();!(t=e.n()).done;){var r=t.value;r.samples.length=0,r.dataOffset=0,r.sequenceDts=null,r.timestampOffset=0,r.totalDuration=0,r.totalSampleCount=0}}catch(t){e.e(t)}finally{e.f()}}},{key:"input",value:function(t){try{this._parser.input(t)}catch(t){if(this._onError){var e="DtsError"===t.name?h.errorFlvDts:h.errorFlvPacket;this._onError(e,t.message)}}}},{key:"_addSample",value:function(t,e){t.samples.push(e),t.totalSampleCount++,this._mdatSize+=e.size}},{key:"_onAudioSample",value:function(e){var r=e.dts;if(-1===this._videoTrackIndex&&this._timeToOutput(!1,r)&&this._outputDataSegment(r),this._audioTrackIndex>=0&&this._audioTrackIndex<this._tracks.length){var i=this._tracks[this._audioTrackIndex];if(null===i.sequenceDts&&(i.sequenceDts=r),i.objectType===u.audioTypeAAC){var n=i.audioInfo.rate,a=t._millisecToAudioTs(r,i)-i.totalDuration;if(a>=i.maxGapDuration){var s=a/n;if(s>=30)throw new h.SomeError("DtsError","too large ".concat(s," underflow"));var o=Math.floor(a/i.defaultDuration);for(console.log("insert ".concat(o," frames due to ").concat(s," underflow"));o--;){var c=t._getSilentAacFrame(i,e.data);c.duration=i.defaultDuration,i.totalDuration+=c.duration,this._addSample(i,c)}}else if(a<=-i.maxGapDuration)return void console.log("skip 1 frame due to ".concat(-a/n," overflow"))}e.dts=i.totalDuration,e.duration=i.defaultDuration,i.totalDuration+=e.duration,this._addSample(i,e)}else console.warn("invalid audio track: ".concat(this._audioTrackIndex))}},{key:"_onVideoSample",value:function(e){var r=e.dts,i=1===e.flags;if(this._timeToOutput(i,r)&&(this._outputDataSegment(r),this._segmentIsGop=i),this._videoTrackIndex>=0&&this._videoTrackIndex<this._tracks.length){var n=this._tracks[this._videoTrackIndex];if(null===n.sequenceDts&&(n.sequenceDts=r,0===n.totalSampleCount&&(e.cts=0),e.flags=1),e.cts=Math.floor(90*e.cts),e.dts=t._millisecToVideoTs(r,n),n.samples.length>0){var a=n.samples[n.samples.length-1];a.duration=e.dts>a.dts?e.dts-a.dts:0}n.totalDuration=e.dts,n.totalSampleCount>0&&(n.averageDuration=Math.floor(n.totalDuration/n.totalSampleCount)),e.type!==c.typeVideoH264&&e.type!==c.typeVideoH265||this._parseSeiData(e.data,e.size,e.dts/9e4,e.cts/9e4,n.videoInfo.nalu,e.type===c.typeVideoH265),this._addSample(n,e)}else console.warn("invalid video track: ".concat(this._videoTrackIndex))}},{key:"_onAudioTrack",value:function(e){var r=e.type===c.trackAudioAAC,i=r?u.audioTypeAAC:u.audioTypeMP3,n=u.parseAudioInfo(e.data,i);if(n){if(this._audioTrackIndex>=0&&this._audioTrackIndex<this._tracks.length){var a=this._tracks[this._audioTrackIndex];if(t._same_array(a.extraData,e.data))return;this._outputNow(),a.extraData=e.data,a.audioInfo=n,a.objectType=i,a.defaultDuration=n.frame,a.maxGapDuration=2*a.defaultDuration,t._resetTrackTimestamps(a)}else{var s=l.types.mp4a,o=new v("audio",this._nextTrackId++,s);o.extraData=r?e.data:null,o.audioInfo=n,o.objectType=i,o.defaultDuration=n.frame,o.maxGapDuration=2*o.defaultDuration,this._audioTrackIndex=this._tracks.length,this._tracks.push(o),this._outputNow()}this._metaData.audiosamplerate=n.rate,this._metaData.audiochannel=n.channel,this._metaChanged|=1}else this._onError&&this._onError(h.errorAudioInfo,"parse audio track failed")}},{key:"_onVideoTrack",value:function(e){var r=u.parseVideoInfo(e.data,e.type);if(r){if(this._videoTrackIndex>=0&&this._videoTrackIndex<this._tracks.length){var i=this._tracks[this._videoTrackIndex];if(t._same_array(i.extraData,e.data))return;this._outputNow(),i.extraData=e.data,i.videoInfo=r,t._fixLastVideoDuration(i,0),t._resetTrackTimestamps(i)}else{var n=void 0;switch(e.type){case c.trackVideoH264:n=l.types.avc1;break;case c.trackVideoH265:n=l.types.hvc1}var a=new v("video",this._nextTrackId++,n);a.extraData=e.data,a.videoInfo=r,this._videoTrackIndex=this._tracks.length,this._tracks.push(a),this._outputNow()}this._metaData.width=r.width,this._metaData.height=r.height,this._metaData.fps||(this._metaData.fps=this._metaData.framerate),this._metaChanged|=2}else this._onError&&this._onError(h.errorVideoInfo,"parse video track failed")}},{key:"_onMetaDataReceived",value:function(t){if(t)for(var e in t)this._metaData[e]=t[e]}},{key:"_onSampleReceived",value:function(t){switch(t.type){case c.typeAudioAAC:this._onAudioSample(t);break;case c.typeVideoH264:case c.typeVideoH265:this._onVideoSample(t);break;case c.trackAudioAAC:case c.trackAudioMP3:this._onAudioTrack(t);break;case c.trackVideoH264:case c.trackVideoH265:this._onVideoTrack(t);break;default:this._unknownTypes.has(t.type)||(this._unknownTypes.add(t.type),this._onError&&this._onError(h.errorUnknownCodec,"unknown codec: ".concat(t.type)))}return!0}},{key:"_outputDataSegment",value:function(e){if(this._mdatSize&&this._metaChanged){this._onMetaData&&this._onMetaData(this._metaData),this._metaChanged=0;var r=l.initSegment(this._tracks);this._onSegment(r)}var n=this._tracks;if(this._mdatSize){var a=l.moofSize(n),s=8+this._mdatSize,o=new Uint8Array(a+s);o[a+0]=s>>>24&255,o[a+1]=s>>>16&255,o[a+2]=s>>>8&255,o[a+3]=255&s,o.set(l.types.mdat,a+4);var u,h=a+8,c=i(n);try{for(c.s();!(u=c.n()).done;){var f=u.value;f.samples.length>0&&("video"===f.type&&t._fixLastVideoDuration(f,e),this._chrome4x&&(f.samples[0].flags=1),f.baseMediaDecodeTime=f.samples[0].dts),f.dataOffset=h,h=t._concatenateSamplesData(f,o,h)}}catch(t){c.e(t)}finally{c.f()}var d=l.moof(this._sequenceNumber++,n);o.set(d),this._onSegment(o)}this._lastSegmentDts=e,this._mdatSize=0;var _,v=i(n);try{for(v.s();!(_=v.n()).done;){var p=_.value;p.samples.length=0,p.dataOffset=0}}catch(t){v.e(t)}finally{v.f()}}},{key:"_outputNow",value:function(){this._mdatSize>0&&this._outputDataSegment(this._lastSegmentDts)}},{key:"_parseSeiData",value:function(t,e,r,i,n,a){this._onSeiData&&_.parse(t,0,e,r,r+i,n,a,this._onSeiData)}},{key:"_timeToOutput",value:function(t,e){return!(!t||this._segmentIsGop)||e<this._lastSegmentDts||e>=this._lastSegmentDts+this._segmentDuration}},{key:"mimeType",get:function(){var t,e="",r=i(this._tracks);try{for(r.s();!(t=r.n()).done;){var n=t.value;null!==n.audioInfo?e+=n.audioInfo.codecs+",":null!==n.videoInfo&&(e+=n.videoInfo.codecs+",")}}catch(t){r.e(t)}finally{r.f()}for(;e.length>1&&","===e[e.length-1];)e=e.substring(0,e.length-1);return'video/mp4; codecs="'+e+'"'}}],[{key:"_same_array",value:function(t,e){var r=t?t.length:0;if(r!==(e?e.length:0))return!1;for(var i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}},{key:"_concatenateSamplesData",value:function(t,e,r){var n,a=i(t.samples);try{for(a.s();!(n=a.n()).done;){var s=n.value;e.set(s.data,r),r+=s.size}}catch(t){a.e(t)}finally{a.f()}return r}},{key:"_fixLastVideoDuration",value:function(e,r){if(e.samples.length>0){var i=e.samples[e.samples.length-1];0===i.duration&&(r=t._millisecToVideoTs(r,e),i.duration=r>i.dts?r-i.dts:e.averageDuration>0?e.averageDuration:1500,e.totalDuration+=i.duration)}}},{key:"_getSilentAacFrame",value:function(t,e){var r=d.getSilentFrame(t.audioInfo.profile,t.audioInfo.channel),i=t.totalDuration;return new c.Sample(c.typeAudioAAC,r||e,0,i,0)}},{key:"_millisecToAudioTs",value:function(t,e){return Math.floor((t-e.sequenceDts)*e.audioInfo.rate/1e3)+e.timestampOffset}},{key:"_millisecToVideoTs",value:function(t,e){return 90*(t-e.sequenceDts)+e.timestampOffset}},{key:"_resetTrackTimestamps",value:function(t){t.timestampOffset=t.totalDuration,t.sequenceDts=null}}]),t}();t.exports={fMp4Muxer:p}},function(t,e,r){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}var s=r(6).BitStream,o=r(1),u=function(){function t(){i(this,t),this.width=0,this.height=0}return a(t,[{key:"parse",value:function(t){var e=new s(t),r=1,i=this.profile_idc=e.readBits(8),n=e.readBits(8),a=(this.compatibility=n,this.level_idc=e.readBits(8),e.readUe(),0);if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||139===i||134===i||135===i)&&(3===(r=e.readUe())&&(a=e.readBit()),e.readUe(),e.readUe(),e.readBit(),0!==e.readBit()))for(var o=0;o<(3!==r?8:12);o++)e.readBit();e.readUe();var u=e.readUe();if(0===u)e.readUe();else if(1===u){e.readBit(),e.readSe(),e.readSe();var h=e.readUe();for(o=0;o<h;o++)e.readSe()}e.readUe(),e.readBit();var c=e.readUe(),l=e.readUe(),f=e.readBit();0===f&&e.readBit(),e.readBit();var d=e.readBit(),_=0,v=0,p=0,y=0;0!==d&&(_=e.readUe(),v=e.readUe(),p=e.readUe(),y=e.readUe()),e.readBit();var m,g=c+1,k=(l+1)*(2-(0!==f?1:0)),b=0!==f?1:0,w=0!==a?0:r;m=w>3?null:0===w?{dx:1,dy:2-b}:{dx:[0,2,2,1][w],dy:[0,2,1,1][w]*(2-b)};var B=0!==d,S=B?_*m.dx:0,T=B?p*m.dy:0,D=B?v*m.dx:0,M=B?y*m.dy:0;this.width=16*g-D-S,this.height=16*k-M-T}},{key:"displaySize",get:function(){return{width:this.width,height:this.height}}}]),t}(),h=function(){function t(){i(this,t),this.verison=0,this.profile=0,this.compatibility=0,this.level=0,this.nalu=4,this.sps=[]}return a(t,[{key:"parse",value:function(t){var e=t.length;if(e<7)return-1;this.version=t[0],this.profile=t[1],this.compatibility=t[2],this.level=t[3],this.nalu=1+(3&t[4]);var r=31&t[5];if(0===r)return-1;for(var i=6,n=0;n<r&&i+2<e;++n){var a=t[i]<<8|t[i+1];if(a+i+2+1>=e)return-1;try{var s=t.subarray(i+2+1,i+2+a-1),o=new u;o.parse(s),this.sps.push(o),0===n&&(this.profile=o.profile_idc,this.compatibility=-4&o.compatibility,this.level=o.level_idc)}catch(t){console.warn("parse avc-sps error")}i+=a+2}return 0}},{key:"codecs",get:function(){return"avc1."+o.to02xString(this.profile)+o.to02xString(this.compatibility)+o.to02xString(this.level)}},{key:"displaySize",get:function(){var t=this.sps.length?this.sps[0].displaySize:null;return t||(t={width:1280,height:720}),t}}]),t}();t.exports.AvcParser=h},function(t,e,r){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}var s=r(6).BitStream,o=function(){function t(){i(this,t),this.pic_width_in_luma_samples=0,this.pic_height_in_luma_samples=0}return a(t,[{key:"parse",value:function(t){var e=new s(t);e.readBits(16),e.readBits(4);var r=e.readBits(3);e.readBool(),this.general_profile_space=e.readBits(2),this.general_tier_flag=e.readBool(),this.general_profile_idc=e.readBits(5),this.general_profile_compatibility_flags=e.readBits(32),e.readBool(),e.readBool(),e.readBool(),e.readBool(),e.readBits(32),e.readBits(12),this.general_level_idc=e.readBits(8);for(var i=[],n=[],a=0;a<r;++a)i.push(e.readBool()),n.push(e.readBool());if(r>0)for(a=r;a<8;++a)e.readBits(2);for(a=0;a<r;++a)i[a]&&e.readBits(88),n[a]&&e.readBits(8);e.readUe(),3===e.readUe()&&e.readBool(),this.pic_width_in_luma_samples=e.readUe(),this.pic_height_in_luma_samples=e.readUe()}},{key:"displaySize",get:function(){return{width:this.pic_width_in_luma_samples,height:this.pic_height_in_luma_samples}}}]),t}(),u=function(){function t(){i(this,t),this.general_profile_space=0,this.general_profile_idc=0,this.general_level_idc=0,this.general_tier_flag=0,this.general_profile_compatibility_flags=0,this.nalu=4,this.sps=[]}return a(t,[{key:"parse",value:function(t){var e=t.length;if(e<23)return-1;if(1!==t[0])return-1;this.general_profile_space=t[1]>>6&3,this.general_tier_flag=t[1]>>5&1,this.general_profile_idc=31&t[1],this.general_profile_compatibility_flags=t[2]<<24|t[3]<<16|t[4]<<8|t[5];var r=t[6]<<24|t[7]<<16|t[8]<<8|t[9];r=r<<16|t[10]<<8|t[11],this.general_level_idc=t[12],this.nalu=1+(3&t[21]);for(var i=t[22],n=23,a=0;a<i;a++){if(n+3>t+e)return-1;var s=t[n],u=t[n+1]<<8|t[n+2];n+=3;for(var h=0;h<u;h++){if(n+2>e)return-1;var c=t[n]<<8|t[n+1];if(n+2+c>e)return-1;if(33==(63&s))try{var l=t.subarray(n+2,n+2+c),f=new o;f.parse(l),this.sps.push(f),0==h&&(this.general_profile_compatibility_flags=f.general_profile_compatibility_flags,this.general_profile_space=f.general_profile_space,this.general_profile_idc=f.general_profile_idc,this.general_tier_flag=f.general_tier_flag?1:0,this.general_level_idc=f.general_level_idc)}catch(t){console.warn("parse hevc-sps error")}n+=2+c}}return 0}},{key:"codecs",get:function(){var t=this.general_profile_compatibility_flags;return t=(t=(t=(t=(t=t>>1&1431655765|(1431655765&t)<<1)>>2&858993459|(858993459&t)<<2)>>4&252645135|(252645135&t)<<4)>>8&16711935|(16711935&t)<<8)>>16|t<<16,"hvc1."+["","A","B","C"][this.general_profile_space%4]+this.general_profile_idc.toString()+"."+t.toString(16).toLowerCase()+"."+["L","H"][this.general_tier_flag%2]+this.general_level_idc.toString()}},{key:"displaySize",get:function(){var t=this.sps.length?this.sps[0].displaySize:null;return t||(t={width:1280,height:720}),t}}]),t}();t.exports.HevcParser=u},function(t,e,r){function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=r(7).AmfParser,s=function t(e,r,i,a,s){n(this,t),this.type=e,this.data=r,this.cts=i,this.dts=a,this.duration=0,this.size=r.length,this.flags=s},o=function(){function t(e,r){n(this,t),this._buffer=new Uint8Array(2097152),this._readPos=0,this._writePos=0,this._onSampleParsed=e,this._onMetaDataParsed=r}var e,r,o;return e=t,o=[{key:"_readUint32",value:function(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}}],(r=[{key:"clear",value:function(){this._readPos=0,this._writePos=0}},{key:"input",value:function(t){for(this._writeToBuffer(t);this._parsePacket(););}},{key:"_parseHeader",value:function(){var e=this._writePos-this._readPos;if(e<9)return!1;var r=t._readUint32(this._buffer,this._readPos+5)+4;return!(e<r||(this._readPos+=r,0))}},{key:"_parsePacket",value:function(){var t=this._readPos,e=this._writePos-t;if(e<11)return!1;var r=this._buffer,i=r[t],n=r[t+1]<<16|r[t+2]<<8|r[t+3];if(5002753===n&&70===i)return this._parseHeader();if(n<=0||n>=12582912)throw new RangeError("invalid data size: ".concat(n));var a=11+n+4;if(e<a)return!1;this._readPos+=a;var s=r[t+4]<<16|r[t+5]<<8|r[t+6]|r[t+7]<<24,o=t+11,u=!0;switch(31&i){case 8:u=this._parseAudio(o,n,s);break;case 9:u=this._parseVideo(o,n,s);break;case 18:u=this._parseScript(o,n)}return u}},{key:"_parseAudio",value:function(t,e,r){var i=this._buffer,n=(240&i[t])>>>4;if(10===n){var a=0===i[t+1]?-n:n,o=new s(a,i.subarray(t+2,t+e),0,r,0);return this._onSampleParsed(o)}var u=new s(n,i.subarray(t+1,t+e),0,r,0);return this._onSampleParsed(u)}},{key:"_parseVideo",value:function(t,e,r){var i=this._buffer,n=(240&i[t])>>>4,a=15&i[t];if(7===a||12===a){var o=0===i[t+1]?-a:a,u=i[t+2]<<16|i[t+3]<<8|i[t+4];u=u<<8>>8;var h=new s(o,i.subarray(t+5,t+e),u,r,n);return this._onSampleParsed(h)}var c=new s(a,i.subarray(t+1,t+e),0,r,n);return this._onSampleParsed(c)}},{key:"_parseScript",value:function(t,e){var r=new DataView(this._buffer.buffer,t,e),i=(new a).parse(r);return this._onMetaDataParsed(i),!0}},{key:"_writeToBuffer",value:function(t){var e=t.length;if(this._writePos+e>this._buffer.length){var r=this._writePos-this._readPos,i=Math.max(this._buffer.length,r+2*e),n=new Uint8Array(i);n.set(this._buffer.subarray(this._readPos,this._writePos)),this._buffer=n,this._readPos=0,this._writePos=r}this._buffer.set(t,this._writePos),this._writePos+=e}}])&&i(e.prototype,r),o&&i(e,o),t}();t.exports={typeAudioAAC:10,typeAudioMP3:2,typeVideoH264:7,typeVideoH265:12,trackAudioAAC:-10,trackAudioMP3:-2,trackVideoH264:-7,trackVideoH265:-12},t.exports.Sample=s,t.exports.FlvParser=o},function(t,e){function r(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){u=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw s}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}var n,a,s,o,u,h,c,l,f,d,_,v,p,y,m,g,k,b,w,B,S,T,D,M,x,P,U,A,E,I,C,O,F,R,L,j,N,q,V,H,z,X=Math.pow(2,32)-1;!function(){for(var t in S={avc1:[97,118,99,49],avcC:[97,118,99,67],btrt:[98,116,114,116],dinf:[100,105,110,102],dref:[100,114,101,102],esds:[101,115,100,115],ftyp:[102,116,121,112],hdlr:[104,100,108,114],hvc1:[104,118,99,49],hvcC:[104,118,99,67],mdat:[109,100,97,116],mdhd:[109,100,104,100],mdia:[109,100,105,97],mfhd:[109,102,104,100],minf:[109,105,110,102],moof:[109,111,111,102],moov:[109,111,111,118],mp4a:[109,112,52,97],mvex:[109,118,101,120],mvhd:[109,118,104,100],pasp:[112,97,115,112],sdtp:[115,100,116,112],smhd:[115,109,104,100],stbl:[115,116,98,108],stco:[115,116,99,111],stsc:[115,116,115,99],stsd:[115,116,115,100],stss:[115,116,115,115],stsz:[115,116,115,122],stts:[115,116,116,115],styp:[115,116,121,112],tfdt:[116,102,100,116],tfhd:[116,102,104,100],traf:[116,114,97,102],trak:[116,114,97,107],trun:[116,114,117,110],trex:[116,114,101,120],tkhd:[116,107,104,100],vmhd:[118,109,104,100]})S[t]=new Uint8Array(S[t]);T=new Uint8Array([105,115,111,109]),M=new Uint8Array([97,118,99,49]),x=new Uint8Array([109,112,52,50]),P=new Uint8Array([100,97,115,104]),D=new Uint8Array([0,0,0,1]),U=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),A=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),E={video:U,audio:A},O=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),C=new Uint8Array([0,0,0,0,0,0,0,0]),F=new Uint8Array([0,0,0,0,0,0,0,0]),R=F,L=F,j=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),N=F,I=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}(),n=function(t){var e,r,i=Array.prototype.slice.call(arguments,1),n=0;for(e=0;e<i.length;e++)n+=i[e].byteLength;for((r=new Uint8Array(n+8))[0]=r.byteLength>>>24&255,r[1]=r.byteLength>>>16&255,r[2]=r.byteLength>>>8&255,r[3]=255&r.byteLength,r.set(t,4),e=0,n=8;e<i.length;e++)r.set(i[e],n),n+=i[e].byteLength;return r},a=function(){return n(S.dinf,n(S.dref,O))},s=function(t){var e=t.extraData?t.extraData.length:0,r=13+(e>0?e+5:0),i=8+r+5+1,a=new Uint8Array([0,0,0,0,3,128|i>>>21,128|i>>>14,128|i>>>7,127&i,0,1,0,4,128|r>>>21,128|r>>>14,128|r>>>7,127&r,t.objectType,21,0,0,0,0,1,89,40,0,1,89,40]),s=0===e?null:new Uint8Array([5,128|e>>>21,128|e>>>14,128|e>>>7,127&e]),o=new Uint8Array([6,128,128,128,1,2]);return e>0?n(S.esds,a,s,t.extraData,o):n(S.esds,a,o)},o=function(){return n(S.ftyp,T,D,T,x,M,P)},m=function(t){return n(S.hdlr,E[t])},y=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.sampleRate&&(e[12]=t.sampleRate>>>24&255,e[13]=t.sampleRate>>>16&255,e[14]=t.sampleRate>>>8&255,e[15]=255&t.sampleRate),n(S.mdhd,e)},p=function(t){return n(S.mdia,y(t),m(t.type),h(t))},u=function(t){return n(S.mfhd,new Uint8Array([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))},h=function(t){return n(S.minf,"video"===t.type?n(S.vmhd,I):n(S.smhd,C),a(),g(t))},V=function(t){var e=8;e+=16;var i,n=r(t);try{for(n.s();!(i=n.n()).done;){var a=i.value,s=a.samples.length;s>0&&(e+=8,e+=8+(a.defaultDuration?4:0)+16,e+=20,e+=24+s*(a.defaultDuration?4:12))}}catch(t){n.e(t)}finally{n.f()}return e},c=function(t,e){var i=[S.moof];i.push(u(t));var a,s=r(e);try{for(s.s();!(a=s.n()).done;){var o=a.value;o.samples.length>0&&i.push(b(o,0))}}catch(t){s.e(t)}finally{s.f()}return n.apply(null,i)},l=function(t){var e=[S.moov];e.push(d(t.length+1,0));var i,a=r(t);try{for(a.s();!(i=a.n()).done;){var s=i.value;e.push(_(s))}}catch(t){a.e(t)}finally{a.f()}return e.push(f(t)),n.apply(null,e)},f=function(t){var e,i=[S.mvex],a=r(t);try{for(a.s();!(e=a.n()).done;){var s=e.value;i.push(w(s))}}catch(t){a.e(t)}finally{a.f()}return n.apply(null,i)},d=function(t,e){var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]);return n(S.mvhd,r)},g=function(t){return"video"===t.type?n(S.stbl,k(t),n(S.stts,N),n(S.stss,L),n(S.stsc,R),n(S.stsz,j),n(S.stco,F)):n(S.stbl,k(t),n(S.stts,N),n(S.stsc,R),n(S.stsz,j),n(S.stco,F))},k=function(t){return n(S.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===t.type?H(t):z(t))},H=function(t){var e=S.avcC;switch(t.tag){case S.avc1:e=S.avcC;break;case S.hvc1:e=S.hvcC}var r=[t.tag,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),n(e,t.extraData)];if(t.sarRatio){var i=t.sarRatio[0],a=t.sarRatio[1];r.push(n(S.pasp,new Uint8Array([(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i,(4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a])))}return n.apply(null,r)},z=function(t){return n(t.tag,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelCount)>>8,255&t.channelCount,(65280&t.sampleBits)>>8,255&t.sampleBits,0,0,0,0,(65280&t.sampleRate)>>8,255&t.sampleRate,0,0]),s(t))},v=function(t){var e=new Uint8Array([0,0,0,3,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,"audio"===t.type?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return n(S.tkhd,e)},b=function(t,e){var r,i,a,s,o,u=t.defaultDuration,h=u?131114:131106,c="audio"===t.type?33554432:16842752;return r=n(S.tfhd,new Uint8Array(u?[0,(16711680&h)>>16,(65280&h)>>8,255&h,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,(4278190080&u)>>24,(16711680&u)>>16,(65280&u)>>8,255&u,c>>>24&255,c>>>16&255,c>>>8&255,255&c]:[0,(16711680&h)>>16,(65280&h)>>8,255&h,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c])),s=Math.floor(t.baseMediaDecodeTime/(X+1)),o=Math.floor(t.baseMediaDecodeTime%(X+1)),i=n(S.tfdt,new Uint8Array([1,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o>>>24&255,o>>>16&255,o>>>8&255,255&o])),a=B(t,e),n(S.traf,r,i,a)},_=function(t){return n(S.trak,v(t),p(t))},w=function(t){var e=new Uint8Array([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0]);return n(S.trex,e)},B=function(t,e){var r=e+t.dataOffset,i=t.samples,a=i.length,s=t.defaultDuration,o=a>0&&1===i[0].flags,u=new Uint8Array(16+a*(s?4:12)),h=517;s||(h|=2304),u.set([1,(16711680&h)>>16,(65280&h)>>8,255&h,(4278190080&a)>>>24,(16711680&a)>>>16,(65280&a)>>>8,255&a,(4278190080&r)>>>24,(16711680&r)>>>16,(65280&r)>>>8,255&r],0);var c=12;if(u.set(o?[2,0,0,0]:[1,1,0,0],c),c+=4,s)for(var l=0;l<a;l++){var f=i[l].size;u.set([(4278190080&f)>>>24,(16711680&f)>>>16,(65280&f)>>>8,255&f],c),c+=4}else for(l=0;l<a;l++){var d=i[l],_=d.duration,v=d.size,p=d.cts;u.set([(4278190080&_)>>>24,(16711680&_)>>>16,(65280&_)>>>8,255&_,(4278190080&v)>>>24,(16711680&v)>>>16,(65280&v)>>>8,255&v,(4278190080&p)>>>24,(16711680&p)>>>16,(65280&p)>>>8,255&p],c),c+=12}return n(S.trun,u)},q=function(t){var e,r=o(),i=l(t);return(e=new Uint8Array(r.byteLength+i.byteLength)).set(r),e.set(i,r.byteLength),e},t.exports={moof:c,moov:l,types:S,initSegment:q,moofSize:V}},function(t,e){t.exports.lowerBound=function(t,e){for(var r=0,i=t.length;0!=i;){var n=i>>1,a=r+n;t[a]<e?(r=++a,i-=n+1):i=n}return r}},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,i=c(t);if(e){var n=c(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return u(this,r)}}function u(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?h(t):e}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=r(0),f=r(4),d=r(9).Fetcher,_=r(20).fMp4Parser,v=r(22),p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(u,t);var e,r,i=o(u);function u(t,e){var r;return function(t,e){if(!(t instanceof u))throw new TypeError("Cannot call a class as a function")}(this),r=i.call(this,t,e),console.log("Hls7Player ".concat(r.version)),r._playlist=null,r._fetchM3u8Timer=void 0,r._fetchM3u8Binder=r._fetchM3u8.bind(h(r)),r._onM3u8ResponsedBinder=r._onM3u8Responsed.bind(h(r)),r._onM3u8FetchedBinder=r._onM3u8Fetched.bind(h(r)),r._onM3u8FetchErrorBinder=r._onM3u8FetchError.bind(h(r)),r._fetchedM4sCount=0,r._fetchingBegin=0,r._lastFetchM3u8=0,r._lastM3u8Sequence=0,r._lastM3u8Updated=0,r._initDone=!1,r._lastDuration=0,r._totalDuration=0,r._tryM3u8Times=0,r._pendingBuffers=[],r._onM4sResponsedBinder=r._onM4sResponsed.bind(h(r)),r._onM4sFetchedBinder=r._onM4sFetched.bind(h(r)),r._onM4sFetchErrorBinder=r._onM4sFetchError.bind(h(r)),r._mp4Parser=null,r._onM4sParsedBinder=r._onM4sParsed.bind(h(r)),r._m3u8Fetcher=new d(r._onM3u8ResponsedBinder,r._onM3u8FetchedBinder,r._onM3u8FetchErrorBinder),r._m4sFetcher=new d(r._onM4sResponsedBinder,r._onM4sFetchedBinder,r._onM4sFetchErrorBinder),r._savedFetchAsStream=r._m4sFetcher.fetchAsStream,r._minBufferLength=0,r._onPlaylistUpdate=function(t,e){},r}return e=u,(r=[{key:"destroy",value:function(){a(c(u.prototype),"destroy",this).call(this),void 0!==this._fetchM3u8Timer&&(window.clearTimeout(this._fetchM3u8Timer),this._fetchM3u8Timer=void 0),this._fetchedM4sCount=0,this._mp4Parser=null,this._playlist=null,this._initDone=!1,this._lastDuration=0,this._lastM3u8Sequence=0,this._totalDuration=0,this._tryM3u8Times=0,this._pendingBuffers=[]}},{key:"setP2PContext",value:function(t){this._isDestroied||(t?(null!=t.P2PBufferLength&&(this._minBufferLength=t.P2PBufferLength),null!=t.P2PFetchAsStream&&(this._m4sFetcher.fetchAsStream=t.P2PFetchAsStream),null!=t.onPlaylistUpdate&&(this._onPlaylistUpdate=t.onPlaylistUpdate)):(this._minBufferLength=0,this._m4sFetcher.fetchAsStream=this._savedFetchAsStream,this._onPlaylistUpdate=function(t,e){}),this._playlist&&(this._playlist.onPlaylistUpdate=this._onPlaylistUpdate))}},{key:"getAudioTracks",value:function(){return this._mp4Parser?this._mp4Parser.getAudioTracks():[]}},{key:"switchAudioTrack",value:function(t){return!!this._mp4Parser&&this._mp4Parser.switchAudioTrack(t)}},{key:"_doNextFetch",value:function(){var t=this._playlist,e=t.count,r=t.endOfStream;if(0===e&&r)this._pushEnd();else if(e>0&&(r||this._totalDuration<4e3||t.remainDuration>this._minBufferLength))this._fetchNextM4s();else{void 0!==this._fetchM3u8Timer&&(window.clearTimeout(this._fetchM3u8Timer),this._fetchM3u8Timer=void 0);var i=performance.now()-this._lastFetchM3u8,n=Math.round(this._lastDuration-i);this._tryM3u8Times=0,n>=100?this._fetchM3u8Timer=window.setTimeout(this._fetchM3u8Binder,n):this._fetchM3u8()}}},{key:"_fetchM3u8",value:function(){try{this._fetchingBegin=this._lastFetchM3u8=performance.now(),this._m3u8Fetcher.fetchAsText(this._url,!1,2e3)}catch(t){this._notifyNetworkError(l.errorNetworkFetch,{url:this._url,info:t})}}},{key:"_fetchNextM4s",value:function(){var t=null;try{var e=this._playlist.shift();e&&(t=e.uri,this._lastDuration=Math.floor(1e3*e.duration),this._fetchingBegin=performance.now(),this._m4sFetcher.fetchAsStream(t,!1,this._timeout))}catch(e){this._notifyNetworkError(l.errorNetworkFetch,{url:t,info:e})}this._removeOutdated()}},{key:"_onM3u8Responsed",value:function(t,e){return!(this._isDestroied||(304===e.status?(this._isDestroied||this._doNextFetch(),1):e.ok?(!this._firstResponseNotified&&this.onFirstResponse&&(this._firstResponseNotified=!0,this.onFirstResponse(e)),0):(this._playlist&&(this._playlist.endOfStream=!0),this._notifyNetworkError(l.errorNetworkFetch,{url:t,status:e.status}),1)))}},{key:"_onM3u8Fetched",value:function(t,e,r){var i=performance.now(),n=i-this._fetchingBegin,a=this._playlist;if(e&&a){var s=a.parse(e);if(s==v.parsedAsMaster)return this._url=a.streamUrls[0],console.log("stream url: ".concat(this._url)),a.setUrl(this._url),void this._fetchM3u8();if(s<0&&0===a.count)return void this._notifyParserError(l.errorM3u8Data,{url:t,info:s});if(this._lastM3u8Sequence!==a.lastSequence)this._lastM3u8Sequence=a.lastSequence,this._lastM3u8Updated=i;else if(i>=this._lastM3u8Updated+this._timeout)return void this._notifyParserError(l.errorM3u8NotUpdate,{url:t,info:Math.round(i-this._lastM3u8Updated)})}if(a&&a.count>0&&!this._initDone){var o=a.shift();try{new d(this._onM4sResponsedBinder,this._onInitM4sFetched.bind(this),this._onM4sFetchErrorBinder).fetchAsBuffer(o.uri)}catch(t){this._notifyNetworkError(l.errorNetworkFetch,{url:o?o.uri:null,info:t})}}this._isDestroied||(this._doNextFetch(),this._onUrlFetchDone(t,n))}},{key:"_onM3u8FetchError",value:function(t,e,r){e===l.errorNetworkTimeout&&!this._isDestroied&&++this._tryM3u8Times<3?(console.warn("fetch ".concat(this._tryM3u8Times,": ").concat(t," after 1s timeout")),this._fetchM3u8()):this._notifyNetworkError(e,{url:t,info:r})}},{key:"_onM4sResponsed",value:function(t,e){return!(this._isDestroied||!e.ok&&(this._notifyNetworkError(l.errorNetworkFetch,{url:t,status:e.status}),1))}},{key:"_onInitM4sFetched",value:function(t,e,r){var i=performance.now()-this._fetchingBegin;e&&(this._parseM4s(t,e,r),this._receivedBytes+=e.byteLength),r&&(this._initDone=!0,this._fetchedM4sCount++,this._onUrlFetchDone(t,i))}},{key:"_onM4sFetched",value:function(t,e,r){if(!this._isDestroied){!this._firstPacketNotified&&this.onFirstPacket&&(this._firstPacketNotified=!0,this.onFirstPacket());var i=performance.now()-this._fetchingBegin;if(r&&(this._totalDuration+=this._lastDuration,this._doNextFetch()),e){var n=this._pendingBuffers;if(this._initDone){for(;n.length>0;){var a=n.shift();this._parseM4s(a.url,a.buffer,a.done)}this._parseM4s(t,e,r)}else n.push({url:t,buffer:e,done:r});this._receivedBytes+=e.byteLength}r&&(this._fetchedM4sCount++,this._onUrlFetchDone(t,i,this._lastDuration))}}},{key:"_onM4sFetchError",value:function(t,e,r){this._notifyNetworkError(e,{url:t,info:r})}},{key:"_onM4sParsed",value:function(t,e){var r=this._mp4Parser;1836019574===e&&r&&r.metaData&&(this._mimeType=r.mimeType,this.onMetaData&&this.onMetaData(r.metaData)),r&&this._ensureMse(r.mimeType),this._pushBuffer(t)}},{key:"_onUrlFetchDone",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.onFileFetched&&this.onFileFetched(t,{used:Math.round(e),duration:r})}},{key:"_parseM4s",value:function(t,e,r){try{this._mp4Parser&&this._mp4Parser.parse(e,r)}catch(e){var i="DtsError"===e.name?l.errorMp4Dts:l.errorMp4Data;this._notifyParserError(i,{url:t,info:e.message})}}},{key:"version",get:function(){return"v1.82"}},{key:"fetchedM4sCount",get:function(){return this._fetchedM4sCount}},{key:"minBufferLength",set:function(t){this._minBufferLength=t}},{key:"src",set:function(t){this.destroy(),this._setup(t),this._playlist=new v.M3u8Parser,this._playlist.setUrl(this._url),this._playlist.onPlaylistUpdate=this._onPlaylistUpdate,this._mp4Parser=new _(this._onM4sParsedBinder,this.onSeiData),this._fetchM3u8()}}])&&n(e.prototype,r),u}(f.LivePlayer);t.exports.Hls7Player=p},function(t,e,r){function i(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){u=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw s}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function a(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s=r(7).AmfParser,o=r(5),u=r(0),h=r(3),c=r(1),l=r(8).SeiParser,f=r(21),d=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var i=h.checkChromeVer();this._chrome4x=i>0&&i<=49,this.uint32_max=Math.pow(2,32),this.mimeType=null,this.metaData={},this._audioChannel=void 0,this._audioRate=void 0,this._audioCodec=null,this._videoWidth=void 0,this._videoHeight=void 0,this._videoCodec=null,this._videoTag=0,this._videoBaseDts=0,this._videoCtsFixed=!1,this._videoTrackId=void 0,this._videoFrames=[],this._lastMoofSize=void 0,this._lastTrackId=void 0,this._findingStartDts=!1,this._minStartDts=void 0,this._timeScaleMap=new Map,this._buffer=null,this._bytesInBuffer=0,this._onParsed=e,this._onSeiParsed=r,this._parseMoofBoxsBinder=this._parseMoofBoxs.bind(this),this._parseMoovBoxsBinder=this._parseMoovBoxs.bind(this),this._lastFmp4Track=null,this._lastFmp4TrackFragment=null,this._tracks=new Map,this._trackFragments=new Map,this._selectedAudioTrackId=void 0,this._defaultAudioTrackId=void 0}var e,r,n;return e=t,n=[{key:"parseEncoder",value:function(t,e){var r=e,i=e+32;t.getUint8(e)<32&&(r++,i--);var n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength).subarray(r,i);return(new s).decodeUtf8(n)}},{key:"parseH264Codec",value:function(t,e){e+=8;var r=t.getUint8(e+1),i=t.getUint8(e+2),n=t.getUint8(e+3);return"avc1."+c.to02xString(r)+c.to02xString(i)+c.to02xString(n)}},{key:"parseH265Codec",value:function(t,e){e+=8;var r=t.getUint8(e+1),i=r>>6&3,n=r>>5&1,a=31&r,s=t.getUint32(e+2),o=t.getUint8(e+12),u=s;return u=(u=(u=(u=(u=u>>>1&1431655765|(1431655765&u)<<1)>>>2&858993459|(858993459&u)<<2)>>>4&252645135|(252645135&u)<<4)>>>8&16711935|(16711935&u)<<8)>>>16|u<<16,"hvc1."+["","A","B","C"][i%4]+a.toString()+"."+u.toString(16).toLowerCase()+"."+["L","H"][n%2]+o.toString()}}],(r=[{key:"getAudioTracks",value:function(){var t=this,e=[];return this._tracks.forEach(function(r,i){"soun"===r.handler&&e.push({enabled:t._selectedAudioTrackId===r.trackId,id:r.trackId,kind:r.isDefault?"main":"",label:r.label,language:r.language,default:t._defaultAudioTrackId===r.trackId})}),e}},{key:"switchAudioTrack",value:function(t){var e;return"soun"===(null===(e=this._tracks.get(t))||void 0===e?void 0:e.handler)&&(this._selectedAudioTrackId=t,!0)}},{key:"clear",value:function(){this._buffer=null,this._bytesInBuffer=0}},{key:"parse",value:function(t,e){var r=this,i=0!==this._bytesInBuffer;i&&(this._appendBuffer(new Uint8Array(t)),t=this._buffer.subarray(0,this._bytesInBuffer));for(var n=new Uint8Array(t),a=new DataView(n.buffer),s=n.byteLength,o=0;o+8<=s;){var u=a.getUint32(o),h=o+u;if(h>s)break;var c=a.getUint32(o+4),l=n.subarray(o,h);switch(c){case 1836019558:if(void 0===this._minStartDts&&(this._findingStartDts=!0,this._parseBox(a,o,h,this._parseMoofBoxsBinder),this._findingStartDts=!1),this._lastMoofSize=u,this._lastTrackId=void 0,this._videoFrames.length=0,i)this._parseBox(a,o,h,this._parseMoofBoxsBinder);else{var f=new Uint8Array(l);this._parseBox(new DataView(f.buffer),0,u,this._parseMoofBoxsBinder),l=f}break;case 1836019574:if(this._lastTrackId=void 0,this._parseBox(a,o,h,this._parseMoovBoxsBinder)){var d=void 0,_=void 0;this._tracks.forEach(function(t,e){"soun"===t.handler&&(void 0===d&&(d=t.trackId),void 0===_&&!0===t.isDefault&&(_=t.trackId))});var v=d;void 0!==_&&(v=_),this._defaultAudioTrackId=v,this._selectedAudioTrackId=v,this._tracks.forEach(function(t,e){"soun"===t.handler&&r._defaultAudioTrackId!==t.trackId&&r._changeBoxTag(a,t.trakBoxOffset,1718773093)}),this._updateMediaInfo(),this._updateMimeType()}break;case 1835295092:this._videoFrames.length&&(this._parseMdatBox(l,u),this._videoFrames.length=0)}this._onParsed(l,c),o=h}i&&0===o||(o>=s?this._bytesInBuffer=0:(this._bytesInBuffer=0,!e&&o<s&&this._appendBuffer(n.subarray(o))))}},{key:"_changeBoxTag",value:function(t,e,r){t.setUint32(e+4,r)}},{key:"_appendBuffer",value:function(t){var e=this._bytesInBuffer+t.length,r=new Uint8Array(e);this._buffer&&this._bytesInBuffer&&r.set(this._buffer.subarray(0,this._bytesInBuffer),0),this._buffer=r,this._buffer.set(t,this._bytesInBuffer),this._bytesInBuffer=e}},{key:"_parseMoovBoxs",value:function(t,e,r,i){switch(r){case 1836019574:case 1953653099:case 1835297121:case 1835626086:case 1937007212:return 1953653099===r&&(this._lastFmp4Track=new f.fMp4Track(e)),this._parseBox(t,e+8,e+i,this._parseMoovBoxsBinder);case 1937011556:this._parseStsdBox(t,e,i);break;case 1835296868:this._parseMdhdBox(t,e,i);break;case 1751411826:this._parseHdlrBox(t,e,i);break;case 1953196132:this._parseTkhdBox(t,e,i)}return!0}},{key:"_parseMoofBoxs",value:function(t,e,r,i){var n;switch(r){case 1836019558:case 1953653094:return 1953653094===r&&(this._lastFmp4TrackFragment=new f.fMp4TrackFragment(e)),this._parseBox(t,e+8,e+i,this._parseMoofBoxsBinder);case 1952868452:this._lastTrackId=t.getUint32(e+8+4),this._lastFmp4TrackFragment.trackId=this._lastTrackId,this._trackFragments.set(this._lastTrackId,this._lastFmp4TrackFragment),"soun"===(null===(n=this._tracks.get(this._lastTrackId))||void 0===n?void 0:n.handler)&&(this._selectedAudioTrackId!==this._lastTrackId?this._changeBoxTag(t,this._lastFmp4TrackFragment.trafBoxOffset,1718773093):t.setUint32(e+8+4,this._defaultAudioTrackId));break;case 1952867444:this._parseTfdtBox(t,e,i);break;case 1953658222:this._parseTrunBox(t,e,i)}return!0}},{key:"_parseMdhdBox",value:function(t,e,r){e+=12,e+=8,this._timeScaleMap[this._lastTrackId]=t.getUint32(e),e+=8;var i=t.getUint16(e),n=String.fromCharCode(96+(i>>10),96+(i>>5&31),96+(31&i));this._lastFmp4Track.language=n}},{key:"_parseHdlrBox",value:function(t,e,r){var i=12;i+=4;var n=new Uint8Array(t.buffer,e+i,4),a=(new s).decodeUtf8(n),o="";if(r-(i+=16)>0){var u=new Uint8Array(t.buffer,e+i,r-i);o=(new s).decodeUtf8(u)}this._lastFmp4Track.handler=a,this._lastFmp4Track.label=o,this._tracks.has(this._lastTrackId)&&(this._tracks.clear(),this._defaultAudioTrackId=void 0,this._selectedAudioTrackId=void 0),this._tracks.set(this._lastFmp4Track.trackId,this._lastFmp4Track)}},{key:"_parseTkhdBox",value:function(t,e,r){var i=8,n=t.getUint32(e+i);this._lastFmp4Track.isDefault=0!=(1&n),i+=4,i+=8,this._lastTrackId=t.getUint32(e+i),this._lastFmp4Track.trackId=this._lastTrackId}},{key:"_parseStsdBox",value:function(e,r,i){r+=12;var n=e.getUint32(r);if(r+=4,0!==n){e.getUint32(r),r+=4;var a=e.getUint32(r);r+=4;var s=0;switch(a){case 1635148593:case 1752589105:this.metaData.fps=e.getUint32(r+16)/100,this.metaData.videodatarate=e.getUint32(r+20)/1e3,this._videoWidth=e.getUint16(r+24),this._videoHeight=e.getUint16(r+26),this.metaData.encoder=t.parseEncoder(e,r+42),r+=78,(s=e.getUint32(r))>=12?1635148593===a?this._videoCodec=t.parseH264Codec(e,r):1752589105===a&&(this._videoCodec=t.parseH265Codec(e,r)):1635148593===a?this._videoCodec="avc1.64002a":1752589105===a&&(this._videoCodec="hvc1.1.6.L93.90"),this._videoTag=a,this._videoTrackId=this._lastTrackId;break;case 1836069985:this._audioChannel=e.getUint16(r+16),this._audioRate=e.getUint32(r+24)>>>16,r+=28,s=e.getUint32(r),this._audioCodec=s>=10?this._parseAudioCodec(e,r):"mp4a.40.2";break;case 1700998451:this._audioChannel=e.getUint16(r+16),this._audioRate=e.getUint32(r+24)>>>16,this._audioCodec="ec-3"}}}},{key:"_parseTfdtBox",value:function(t,e,r){e+=8;var i=t.getUint8(e);e+=4;var n=1===i?this.getUint64(t,e):t.getUint32(e);if(void 0!==this._lastTrackId){if(this._findingStartDts){var a=n/this._timeScaleMap[this._lastTrackId];return void((this._minStartDts>a||void 0===this._minStartDts)&&(this._minStartDts=a,console.log("track ".concat(this._lastTrackId," start dts: ").concat(a))))}var s=Math.floor(this._minStartDts*this._timeScaleMap[this._lastTrackId]),o=n-s;if(o<0)throw new u.SomeError("DtsError","wrong dts: ".concat(n,"<").concat(s," in track ").concat(this._lastTrackId));1===i?this.setUint64(t,e,o):t.setUint32(e,o),this._lastTrackId===this._videoTrackId&&(this._videoBaseDts=o)}}},{key:"_parseTrunBox",value:function(t,e,r){if(this._lastTrackId===this._videoTrackId){e+=8;var i=16777215&t.getUint32(e);this._chrome4x&&4&i&&t.setUint32(e+12,33554432),e+=4;var n=t.getUint32(e);if(e+=4,0!==n){if(!this._videoCtsFixed&&2048&i){var a=e;1&i&&(e+=4),4&i&&(e+=4),256&i&&(e+=4),512&i&&(e+=4),0!==t.getInt32(e)&&t.setInt32(e,0),this._videoCtsFixed=!0,e=a}if(this._onSeiParsed){var s=0;1&i&&(s=t.getUint32(e)-this._lastMoofSize,e+=4),4&i&&(e+=4);for(var o=this._videoBaseDts,u=0;u<n;u++){var h=t.getUint32(e);e+=4;var c=t.getUint32(e);e+=4;var l=t.getInt32(e);e+=4,this._videoFrames.push({dts:o,cts:l,offset:s,size:c}),o+=h,s+=c}}}}}},{key:"_parseMdatBox",value:function(t,e){var r,n=i(this._videoFrames);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(!this._onSeiParsed||a.offset+a.size>e)break;var s=this._timeScaleMap[this._videoTrackId];s=1/(s||9e4);var o=a.dts*s,u=o+a.cts*s;l.parse(t,a.offset,a.size,o,u,4,1752589105===this._videoTag,this._onSeiParsed)}}catch(t){n.e(t)}finally{n.f()}}},{key:"_parseAudioCodec",value:function(t,e){e+=8,e+=4,e+=8,e+=5;var r=t.getUint8(e);if(107==r||105==r)return"mp3";e+=9,this.metaData.audiodatarate=t.getUint32(e)/1e3,e+=4,e+=5;var i=t.getUint8(e)>>>3&31;return o.getAacCodec(r,i)}},{key:"_parseBox",value:function(t,e,r,i){for(;e+8<=r;){var n=t.getUint32(e),a=t.getUint32(e+4);if(e+n>r||!i(t,e,a,n))return!1;e+=n}return e<=r}},{key:"_updateMediaInfo",value:function(){void 0!==this._audioRate&&(this.metaData.audiosamplerate=this._audioRate),void 0!==this._audioChannel&&(this.metaData.audiochannel=this._audioChannel),void 0!==this._videoWidth&&(this.metaData.width=this._videoWidth),void 0!==this._videoHeight&&(this.metaData.height=this._videoHeight)}},{key:"_updateMimeType",value:function(){var t='video/mp4; codecs="';if(this._audioCodec&&this._videoCodec)t+=this._videoCodec+","+this._audioCodec;else if(this._audioCodec)t+=this._audioCodec;else{if(!this._videoCodec)return;t+=this._videoCodec}this.mimeType=t+'"'}},{key:"getUint64",value:function(t,e){var r=t.getUint32(e),i=t.getUint32(e+4);return r*this.uint32_max+i}},{key:"setUint64",value:function(t,e,r){t.setUint32(e,r>=this.uint32_max?Math.floor(r/this.uint32_max):0),t.setUint32(e+4,4294967295&r)}}])&&a(e.prototype,r),n&&a(e,n),t}();t.exports.fMp4Parser=d},function(t,e){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t.exports={fMp4Track:function t(e){r(this,t),this.trakBoxOffset=e,this.handler=void 0,this.trackId=void 0,this.language=void 0,this.isDefault=void 0,this.label=void 0},fMp4TrackFragment:function t(e){r(this,t),this.trafBoxOffset=e,this.trackId=void 0}}},function(t,e){function r(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return i(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){u=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw s}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.onPlaylistUpdate=function(t,e){},this.endOfStream=!1,this.mimeType=null,this.streamUrls=[],this._initUris=new Set,this._lastSeq=0,this._lastUri=null,this._nextSequence=void 0,this._remainDuration=0,this._totalCount=0,this._totalDuration=0,this._dataUrls=[],this._url=null}var e,i;return e=t,(i=[{key:"setUrl",value:function(t){var e=t.lastIndexOf("/"),r=t.lastIndexOf("?");this._relativePath=t.substring(0,e+1),this._queryParams=r>0?t.substring(r):null,this._url=t,this._initUris.clear(),this._lastSeq=0,this._lastUri=null,this._nextSequence=void 0}},{key:"parse",value:function(t){for(var e=void 0,i=void 0,n=void 0,a=void 0,s=null,o=null,u=0,h=[],c=[],l=this._initUris.size,f=t.length,d=0;d<f;){var _=t.indexOf("\n",d);-1===_&&(_=f);var v=t.substring(d,_);if(d=_+1,0!==v.length)if("#"===v[0]){var p=v.indexOf(":");if(p>0){var y=v.substring(0,p),m=v.substring(p+1);if("#EXTINF"===y){var g=m.lastIndexOf(",");s=-1!==g?m.substring(0,g):m.substring(0),o=-1!==g?m.substring(g+1,m.length):null,u=1}else if("#EXT-X-VERSION"===y)e=parseInt(m.trim());else if("#EXT-X-MEDIA-SEQUENCE"===y)n=i=parseInt(m.trim());else if("#EXT-X-MAP"===y){var k=m.trim();if(k.length<=5||'URI="'!==k.substring(0,5))return console.warn("wrong #EXT-X-MAP: ".concat(m)),-2;var b=(k=k.substring(5)).lastIndexOf('"');k=-1!==b?k.substring(0,b):k.substring(0),this._initUris.has(k)||(h.push({uri:k,duration:this.averageDuration,title:"",seq:void 0}),this._initUris.add(k))}else"#EXT-X-STREAM-INF"===y&&(u=2)}else"#EXT-X-ENDLIST"===v&&(a=!0)}else 1===u?(this._lastSeq=n++,this._lastUri=v.trim(),h.push({uri:this._lastUri,duration:s.trim(),title:o,seq:this._lastSeq}),s=null,o=null,u=0):2===u&&(c.push(v),u=0)}if(this.streamUrls=c,c.length>0)return 1;if(void 0===e||e<6)return console.warn("wrong #EXT-X-VERSION: ".concat(e)),-1;if(void 0!==a&&(this.endOfStream=a),0===this._initUris.size&&!this.endOfStream)return console.warn("missing #EXT-X-MAP URI"),-2;if(this._nextSequence!==n||l!==this._initUris.size){if(void 0===this._nextSequence&&(this._nextSequence=i),this._nextSequence<i&&this._nextSequence+30>=i&&this._lastUri){console.warn("lost sequence: ".concat(this._nextSequence," -> ").concat(i));for(var w=this.averageDuration,B=this._lastSeq.toString(),S=i-1;S>=this._nextSequence;S--){var T=this._lastUri.replace(B,S.toString());h.unshift({uri:T,duration:w})}}var D,M=r(h);try{for(M.s();!(D=M.n()).done;){var x=D.value;(x.seq>=this._nextSequence||void 0===x.seq)&&(x.duration=parseFloat(x.duration),isNaN(x.duration)&&(x.duration=this.averageDuration),this._appendEntry(x))}}catch(t){M.e(t)}finally{M.f()}this._nextSequence<n&&(this._nextSequence=n)}return 0}},{key:"shift",value:function(){var t=this._dataUrls.length>0?this._dataUrls.shift():null;return t&&(this._remainDuration-=t.duration),t}},{key:"_appendEntry",value:function(t){t.uri=this._buildM4sUrl(t.uri),this._dataUrls.push(t),this.onPlaylistUpdate(!1,t),this._remainDuration+=t.duration,this._totalCount++,this._totalDuration+=t.duration}},{key:"_buildM4sUrl",value:function(t){var e=-1!==t.indexOf("://")?t:this._relativePath+t;return null!==this._queryParams&&(-1!==t.indexOf("?")?e+="&"+this._queryParams.substring(1):e+=this._queryParams),e}},{key:"count",get:function(){return this._dataUrls.length}},{key:"averageDuration",get:function(){return this._totalCount>0?this._totalDuration/this._totalCount:0}},{key:"lastSequence",get:function(){return this._nextSequence>0?this._nextSequence-1:0}},{key:"remainDuration",get:function(){return this._remainDuration}}])&&n(e.prototype,i),t}();t.exports={M3u8Parser:a,parsedOk:0,parsedAsMaster:1,parsedErrorVer:-1,parsedErrorInit:-2}},function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,i=h(t);if(e){var n=h(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return u(this,r)}}function u(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(u,t);var e,r,i=o(u);function u(t,e){var r;return function(t,e){if(!(t instanceof u))throw new TypeError("Cannot call a class as a function")}(this),r=i.call(this,t,e),console.log("NativePlayer ".concat(r.version)),r}return e=u,(r=[{key:"destroy",value:function(){a(h(u.prototype),"destroy",this).call(this)}},{key:"version",get:function(){return"v1.0"}},{key:"src",set:function(t){this.destroy(),this._player.src=t,0!==this.startTime&&(this._player.currentTime=this.startTime)}}])&&n(e.prototype,r),u}(r(4).LivePlayer);t.exports.NativePlayer=c}])});
}
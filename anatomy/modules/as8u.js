/**
 * id: as8u
 * path: ./common/controller
 */

(function(require,module,exports) {
"use strict";var t,e,n,i,r,o,s,a,l,u,c,h,f,d,p,v=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{l(i.next(t))}catch(e){o(e)}}function a(t){try{l(i.throw(t))}catch(e){o(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}l((i=i.apply(t,e||[])).next())})},w=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(a){o=[6,a],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},y=this&&this.__classPrivateFieldSet||function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},b=this&&this.__classPrivateFieldGet||function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},S=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ControllerEventType=void 0;var m,g=S(require("@bilibili-live/web-player-controller")),C=require("@bilibili-live/web-player-common"),k=S(require("@bilibili-live/web-player-track"));!function(t){t.BottomDistanceChange="bottomDistanceChange"}(m=exports.ControllerEventType||(exports.ControllerEventType={}));var E=function(){function S(S,k){var E=this;this.container=S,this.opts=k,t.set(this,new C.EventBus),e.set(this,void 0),n.set(this,void 0),i.set(this,void 0),r.set(this,new Set),o.set(this,new Set),s.set(this,void 0),a.set(this,!1),l.set(this,!0),u.set(this,0),c.set(this,0),h.set(this,function(){}),this.on=b(this,t).on,f.set(this,b(this,t).emit),this.setBottomDistance=function(t){parseInt(getComputedStyle(b(E,e)).bottom)!==t&&(b(E,e).style.bottom=t+"px",b(E,n).style.bottom=t+"px",b(E,f).call(E,m.BottomDistanceChange,t))},d.set(this,function(){if(C.logger.info("Controller onrefresh"),0!==b(E,o).size)for(var t=0,e=Array.from(b(E,o));t<e.length;t++){(0,e[t])()}}),this.getCtrlEl=function(){return b(E,e)},p.set(this,function(t,e){return v(E,void 0,Promise,function(){return w(this,function(n){switch(n.label){case 0:return C.logger.info("Controller onchange: type: "+t+", value: "+JSON.stringify(e)),0===b(this,r).size?[2,!1]:[4,Promise.all(Array.from(b(this,r)).map(function(n){return n(t,e)}))];case 1:return n.sent().includes(!1)?[2,!1]:[2]}})})}),this.changeCtrlVisible=function(t){t?(b(E,n).style.visibility="visible",b(E,e).style.visibility="visible"):(b(E,n).style.visibility="hidden",b(E,e).style.visibility="hidden")},y(this,e,M()),y(this,n,F()),k.enableCtrlUI&&(this.container.appendChild(b(this,n)),S.appendChild(b(this,e))),y(this,i,new g.default({target:b(this,e),props:{show:!1,playStatus:!1,quality:{list:[],value:null},line:{list:[],value:null},onRefresh:b(this,d),onChange:b(this,p),isMobile:this.opts.isMobile,container:S,dmMsg:""}})),this.opts.isMobile?y(this,s,x(S,this,b(this,e))):(y(this,s,T(S,this,b(this,e))),y(this,h,W(this)))}return S.prototype.triggerWebFullscreen=function(){var t,e=!(null!==(t=b(this,i).webFullScreenStatus)&&void 0!==t&&t);b(this,i).webFullScreenStatus=e,b(this,r).forEach(function(t){return t("webFullScreenStatus",e)}),k.default.operation(k.default.OperationCode.WebFullScreenWay,e?1:-1)},S.prototype.onChange=function(t){var e=this;return b(this,r).add(t),function(){b(e,r).delete(t)}},S.prototype.onRefresh=function(t){var e=this;return b(this,o).add(t),function(){b(e,o).delete(t)}},S.prototype.getCtrlUI=function(){return b(this,i)},S.prototype.setMiniMode=function(t){y(this,a,t)},S.prototype.show=function(){clearTimeout(b(this,u)),b(this,a)||b(this,i).show||(b(this,n).style.display="block",b(this,i).show=!0,b(this,r).forEach(function(t){return t("show",!0)}))},S.prototype.delayHide=function(t,e){var n=this;void 0===e&&(e=function(){}),clearTimeout(b(this,u)),y(this,u,window.setTimeout(function(){b(n,l)&&(n.hide(),e())},t))},S.prototype.hide=function(){b(this,i).show&&(b(this,n).style.display="none",b(this,i).show=!1,b(this,r).forEach(function(t){return t("show",!1)}))},S.prototype.setScreenStatus=function(t){var e=!0===b(this,i).webFullScreenStatus?1:!0===b(this,i).fullScreenStatus?2:0;if(e!==t){var n="fullScreenStatus",o=!0;switch(t){case 0:n=["webFullScreenStatus","webFullScreenStatus","fullScreenStatus"][e],o=!1,b(this,i).webFullScreenStatus=!1,b(this,i).fullScreenStatus=!1;break;case 1:n="webFullScreenStatus",b(this,i).webFullScreenStatus=!0,b(this,i).fullScreenStatus=!1;break;case 2:n="fullScreenStatus",b(this,i).webFullScreenStatus=!1,b(this,i).fullScreenStatus=!0}b(this,r).forEach(function(t){return t(n,o)})}},S.prototype.destroy=function(){y(this,r,new Set),y(this,o,new Set),b(this,s).call(this),b(this,i).$destroy(),b(this,e).remove(),b(this,n).remove(),clearTimeout(b(this,u)),clearTimeout(b(this,c)),b(this,h).call(this)},S.prototype.setAutoHide=function(t){y(this,l,t)},S.prototype.getAutoHide=function(){return b(this,l)},S.prototype.showCursor=function(){clearTimeout(b(this,c)),"default"!==this.container.style.cursor&&(this.container.style.cursor="default")},S.prototype.delayHideCursor=function(t){var e=this;clearTimeout(b(this,c)),y(this,c,window.setTimeout(function(){e.container.style.cursor="none"},t))},S}();function M(){var t=document.createElement("div");return t.style.cssText="\n    position: absolute;\n    bottom: 0;\n    width: 100%;\n    z-index: 13;\n  ",t.classList.add("web-player-controller-wrap"),t.id="web-player-controller-wrap-el",t}function F(){var t=document.createElement("div");return t.classList.add("web-player-controller-bg"),t.style.cssText="\n    display: none;\n    position: absolute;\n    bottom: 0;\n    width: 100%;\n    z-index: 10;\n    height: 56px;\n    background-image: linear-gradient(180deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.7));\n  ",t.classList.add("web-player-controller-wrap"),t}function W(t){var e=t.onChange(function(e,n){if("fullScreenStatus"===e||"webFullScreenStatus"===e){if(n)return void t.delayHideCursor(2e3);t.showCursor()}});return function(){e()}}function x(t,e,n){var i=!1,r=function(t){var r=e.getCtrlUI().qualityPanelRef;!i||!_(n,t,!0)&&!0!==(null==r?void 0:r.contains(t.target))?(i=!i)?(e.show(),e.delayHide(2e3,function(){i=!1})):e.hide():e.delayHide(2e3,function(){i=!1})};return e.onChange(function(t,n){"dmInputFocus"===t&&e.setAutoHide(n)}),t.addEventListener("touchstart",r),function(){t.removeEventListener("touchstart",r)}}function T(t,e,n){var i=this,r=function(t){if(e.show(),e.showCursor(),!_(n,t)){e.delayHide(2e3);var i=e.getCtrlUI();!0!==i.webFullScreenStatus&&!0!==i.fullScreenStatus||e.delayHideCursor(2e3)}},o=function(){e.getAutoHide()&&(e.hide(),e.showCursor())},s=function(t){if(!_(n,t)){e.delayHide(2e3);var i=e.getCtrlUI();!0!==i.webFullScreenStatus&&!0!==i.fullScreenStatus||(e.showCursor(),e.delayHideCursor(2e3))}};t.addEventListener("mousemove",r),t.addEventListener("mouseleave",o),t.addEventListener("click",s);var a=function(){v(i,void 0,Promise,function(){return w(this,function(t){return e.triggerWebFullscreen(),[2]})}).catch(function(t){C.logger.error(t)})};return t.addEventListener("dblclick",a),function(){t.removeEventListener("click",s),t.removeEventListener("mousemove",r),t.removeEventListener("mouseleave",o),t.removeEventListener("dblclick",a)}}function _(t,e,n){void 0===n&&(n=!1);var i=t.getBoundingClientRect().top-36-14-(n?52:0);return n?e.touches[0].clientY>i||t.contains(e.target):e.clientY>i||t.contains(e.target)}exports.default=E,t=new WeakMap,e=new WeakMap,n=new WeakMap,i=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,h=new WeakMap,f=new WeakMap,d=new WeakMap,p=new WeakMap;
})()
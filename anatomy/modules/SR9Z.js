/**
 * id: SR9Z
 * path: @bilibili-live/web-player-video-info
 */

(function(require,module,exports) {
"use strict";var e,t,i,a,n,r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__classPrivateFieldSet||function(e,t,i){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,i),i},s=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var p=require("@bilibili-live/web-player-common"),l=d(require("./wave-graph")),h=d(require("./panel")),u="p-video-info-",c=function(){function d(d){var u=this;e.set(this,void 0),t.set(this,void 0),i.set(this,void 0),a.set(this,0),n.set(this,void 0),this.videoTemplate={mimeType:{label:"Mime Type",data:""},playerCore:{label:"Player Core",data:""},videoInfo:{label:"Video Info",data:""},audioInfo:{label:"Audio Info",data:""},encoder:{label:"Encoder",data:""},streamHost:{label:"Stream Host",data:""},bufferLength:{label:"Buffer Length",data:""},droppedFrames:{label:"Decoded Frames",data:""},networkActivity:{label:"Download Bitrate",data:""}},this.template=Object.keys(this.videoTemplate).map(function(e){var t;return(t={})[e]=u.videoTemplate[e].data,t}).reduce(function(e,t){return r(r({},e),t)}),this.templateProxy=this.createTemplateProxy(),o(this,e,d),o(this,i,p.createElement("div")),o(this,n,new l.default({width:180,height:14})),s(this,i).appendChild(this.combineDataElement()),o(this,t,new h.default(s(this,e),{scope:s(this,i),style:{top:"10px",left:"10px"}}))}return d.prototype.show=function(){s(this,t).status=1,this.repaintGraph()},d.prototype.hide=function(){s(this,t).status=0},d.prototype.destroy=function(){for(var e in o(this,i,null),this.templateProxy)this.templateProxy[e]="";s(this,t).destroy(),s(this,n).destroy()},d.prototype.updateVideoTemplate=function(e){if(0!==s(this,t).status){var i=e.mediaInfo,r=e.realtimeInfo,d=Math.floor(r.videoNetworkActivity/1024),l=this.templateProxy;l.mimeType=i.mimeType,l.playerCore=i.corePlayerType,l.videoInfo=i.width+"x"+i.height+", "+i.fps+"FPS",l.audioInfo=i.audioSampleRate/1e3+"KHz, "+i.audioChannel+", "+this.computeBps(i.audioDataRate),l.encoder=i.encoder,l.streamHost=i.videoSrc.split("://")[1].split("/")[0],l.networkActivity=p.roundNumber(d/1024*8,2)+"Mbps",l.bufferLength=r.videoBufferLength+"s, "+(r.latency?r.latency/1e3+"s":"N/A"),l.droppedFrames=r.droppedFrames+"/"+r.decodedFrames+", "+(r.decodedFrames-s(this,a)<0?0:r.decodedFrames-s(this,a))+"FPS",o(this,a,r.decodedFrames),r.decodedFrames>0&&s(this,n).updateGraph(d),this.repaintGraph()}},d.prototype.createTemplateProxy=function(){return new Proxy(this.template,{get:function(e,t,i){if(t in e)return e[t];throw new ReferenceError('Prop name "'+t+'" does not exist.')},set:function(e,t,i,a){var n;if(e[t]!==i){e[t]=i;var r=null===(n=document.getElementById(""+u+t))||void 0===n?void 0:n.querySelector(".web-player-line-data");null!=r&&(r.textContent=i)}return!0}})},d.prototype.repaintGraph=function(){if(0!==s(this,t).status){var e=s(this,n).getGraph(),i=document.querySelector(".web-player-info-graph");null!=i&&(i.innerHTML=e)}},d.prototype.combineDataElement=function(){var e=this,t=document.createDocumentFragment();return Object.keys(this.videoTemplate).forEach(function(i){var a=document.createElement("div");a.id=""+u+i,a.style.cssText+="\n          min-width: 290px;\n          line-height: 18px;\n          font-size: 12px;\n        ",a.innerHTML='\n          <div style="display: inline-block;\n          white-space: nowrap;\n          width: 100px;\n          text-align: right;\n          font-weight: 500;\n          margin-right: 10px;">'+e.videoTemplate[i].label+":</div>\n          "+("networkActivity"===i?'<div style="display: inline-block; margin-right: 10px;" class="web-player-info-graph">'+s(e,n).getGraph()+"</div>":"")+'\n          <div style="display: inline-block; min-width: 58px" class="web-player-line-data">'+e.videoTemplate[i].data+"</div>\n        ",t.appendChild(a)}),t},d.prototype.computeBps=function(e){return e<1e3?p.roundNumber(e,0)+"Kbps":p.roundNumber(e/1e3,1)+"Mbps"},d}();e=new WeakMap,t=new WeakMap,i=new WeakMap,a=new WeakMap,n=new WeakMap,exports.default=c;
})()
/**
 * id: ESUf
 * path: @bilibili-live/web-player-track
 */

function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var r,o=1,t=arguments.length;o<t;o++)for(var a in r=arguments[o])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CustomCode=exports.OperationCode=exports.ErrorCode=exports.EventCode=exports.PerfCode=exports.Category=void 0;var r,o,t,a,n,i,l=require("@bilibili-live/live-web-track");!function(e){e[e.Perf=1]="Perf",e[e.Event=2]="Event",e[e.Error=3]="Error",e[e.Operation=4]="Operation",e[e.Custom=5]="Custom"}(r=exports.Category||(exports.Category={})),function(e){e[e.PlayerResLoad=1]="PlayerResLoad",e[e.FirstPacket=2]="FirstPacket",e[e.VideoMeta=3]="VideoMeta",e[e.FirstFrame=4]="FirstFrame",e[e.Api=5]="Api",e[e.DevicePerf=6]="DevicePerf"}(o=exports.PerfCode||(exports.PerfCode={})),function(e){e[e.RoomPlayerInit=1]="RoomPlayerInit",e[e.CreateVideo=2]="CreateVideo",e[e.CreateRoundPlayer=3]="CreateRoundPlayer",e[e.HomePlayerInit=100]="HomePlayerInit",e[e.ActivityPlayerInit=200]="ActivityPlayerInit",e[e.MobilePlayerInit=300]="MobilePlayerInit"}(t=exports.EventCode||(exports.EventCode={})),function(e){e[e.UnsupportedPlayer=90001]="UnsupportedPlayer",e[e.NativeVideoError=90002]="NativeVideoError",e[e.ApiRequest=91001]="ApiRequest",e[e.ApiResponse=91002]="ApiResponse",e[e.ApiBiz=91003]="ApiBiz",e[e.FirstFrameNotEmit=92001]="FirstFrameNotEmit",e[e.RetryMaxTime=92002]="RetryMaxTime",e[e.SocketConnect=93001]="SocketConnect",e[e.PlayUrlNull=94001]="PlayUrlNull",e[e.RoomP0ApiFetchError=21001]="RoomP0ApiFetchError",e[e.RoomEnterLiveError=21003]="RoomEnterLiveError",e[e.RoomRoundUnknow=22e3]="RoomRoundUnknow",e[e.RoomUnSettingRound=22001]="RoomUnSettingRound",e[e.RoomCantRound=22002]="RoomCantRound",e[e.RoomEnterRoundError=22003]="RoomEnterRoundError",e[e.RoomRoundNotExistDash=22004]="RoomRoundNotExistDash",e[e.ErrorMseOpen=11003]="ErrorMseOpen"}(a=exports.ErrorCode||(exports.ErrorCode={})),function(e){e[e.Play=1]="Play",e[e.Pause=2]="Pause",e[e.Refresh=3]="Refresh",e[e.Mute=4]="Mute",e[e.Volume=5]="Volume",e[e.SwitchQuality=6]="SwitchQuality",e[e.SwitchLine=7]="SwitchLine",e[e.Feedback=8]="Feedback",e[e.TimeShift=9]="TimeShift",e[e.Danmaku=10]="Danmaku",e[e.FullScreen=11]="FullScreen",e[e.WebFullScreen=12]="WebFullScreen",e[e.PictureInPicture=13]="PictureInPicture",e[e.WebFullScreenWay=14]="WebFullScreenWay",e[e.Panorama=15]="Panorama"}(n=exports.OperationCode||(exports.OperationCode={})),function(e){e[e.Waiting=1]="Waiting",e[e.P2PData=2]="P2PData",e[e.UserFeedBack=3]="UserFeedBack",e[e.SEILatency=5]="SEILatency",e[e.StreamErrWhenEnded=100]="StreamErrWhenEnded",e[e.SwitchLine=104]="SwitchLine",e[e.HangUp=105]="HangUp",e[e.NetSpeed=106]="NetSpeed",e[e.AutoDiscardFrame=107]="AutoDiscardFrame",e[e.MutedPlay=108]="MutedPlay",e[e.NotAutoPlay=109]="NotAutoPlay",e[e.VideoPlaybackQuality=110]="VideoPlaybackQuality",e[e.SupportHEVC=111]="SupportHEVC",e[e.VideoEnhance=112]="VideoEnhance"}(i=exports.CustomCode||(exports.CustomCode={}));var d,u=function(e){if(null==e.data)return[];var r=e.data,o=r.ctime,t=r.category,a=r.val,n=r.params;return[r.staticInfo,o,t,r.code,a,n]},s=new l.Tracker("009658",{formatter:u}),c=function(){var e=-1;return function(){return"v"+(e+=1)}}(),p={},y=c();function m(e){d=e.uvid+"|"+e.uid+"|"+e.version+"|"+e.roomId}function v(r,o){if(!0===o)return y=c(),void(p[y]=e({},r));null==p[y]&&(p[y]={}),p[y]=Object.assign({},p[y],r)}function f(e,o,t){var a=void 0===t?{}:t,n=a.extFields,i=a.params,l=a.sampleRate,d=void 0===l?1:l,u=a.randDelay;P({val:Math.round(o),category:r.Perf,code:e,params:null!=i?i:{}},{sample:100*d,randDelay:u,extFields:null!=n?n:["sHost","sProtocol","p2pType","sQuery","x-service-module"]})}function P(r,o){var t,a=Date.now(),n=r.category,i=r.val,l=r.params,u=r.code,c=o.sample,m=o.randDelay,v=o.dynamicFieldsVer,f=o.extFields,P=null!==(t=p[null!=v?v:y])&&void 0!==t?t:{};"all"===f?l=e(e({},l),P):Array.isArray(f)&&(l=f.reduce(function(r,o){var t;return o in P?e(e({},r),((t={})[o]=P[o],t)):r},e({},l)));var E="string"==typeof i?i:null==i?"":JSON.stringify(i),R=0===Object.keys(null!=l?l:{}).length?"":JSON.stringify(l);s.event("playerEvt",{code:u,val:E,ctime:a,category:n,params:R,staticInfo:d},{sample:c,randDelay:m})}function E(e,o,t){var a,n;P({val:o,category:r.Event,code:e},{sample:100*(null!==(a=null==t?void 0:t.sampleRate)&&void 0!==a?a:1),randDelay:null==t?void 0:t.randDelay,extFields:null!==(n=null==t?void 0:t.extFields)&&void 0!==n?n:["sProtocol","sHost","p2pType","sCodec","sFormat"]})}function R(o,t,a){var n,i,l;void 0===a&&(a={}),P({val:t,category:r.Error,code:o,params:e({},null!=a.apiUrl?{apiUrl:a.apiUrl}:{})},{sample:100*(null!==(n=null==a?void 0:a.sampleRate)&&void 0!==n?n:1),randDelay:null!==(i=null==a?void 0:a.randDelay)&&void 0!==i?i:5e3,extFields:null!==(l=a.extFields)&&void 0!==l?l:"all"})}function C(e,o,t){var a;P({val:o,code:e,category:r.Operation},{sample:100*(null!==(a=null==t?void 0:t.sampleRate)&&void 0!==a?a:.1),randDelay:null==t?void 0:t.randDelay,extFields:null==t?void 0:t.extFields})}function F(e,o,t){var a;P({val:o,category:r.Custom,code:e},{sample:100*(null!==(a=null==t?void 0:t.sampleRate)&&void 0!==a?a:1),randDelay:null==t?void 0:t.randDelay,extFields:null==t?void 0:t.extFields})}function x(){var r=y;return{custom:function(e,o,t){F(e,o,Object.assign({},t,{dynamicFieldsVer:r}))},updateDynamicInfo:function(o){p[r]=e(e({},p[r]),o)}}}exports.default={perf:f,event:E,error:R,custom:F,operation:C,PerfCode:o,EventCode:t,ErrorCode:a,OperationCode:n,CustomCode:i,fixedDynamicFieldsVerIns:x,initStaticInfo:m,updateDynamicInfo:v,formatter:u};
}